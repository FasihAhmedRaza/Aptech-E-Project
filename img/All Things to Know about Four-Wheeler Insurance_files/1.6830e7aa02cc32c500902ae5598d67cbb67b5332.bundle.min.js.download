/** Tagove! NOMIN**/(function(){ 
var c$pr='prototype',c$und='undefined',c$fun='function',c$obj='object';var x$=x$||{};x$.scope={};x$.arrayIteratorImpl=function(b){var n=0;return function(){return n<b.length?{done:!1,value:b[n++]}:{done:!0}}};x$.arrayIterator=function(b){return{next:x$.arrayIteratorImpl(b)}};x$.m=function(b){var n=c$und!=typeof Symbol&&Symbol.iterator&&b[Symbol.iterator];return n?n.call(b):x$.arrayIterator(b)};x$.ASSUME_ES5=!1;x$.ASSUME_NO_NATIVE_MAP=!1;x$.ASSUME_NO_NATIVE_SET=!1;x$.SIMPLE_FROUND_POLYFILL=!1;
x$.objectCreate=x$.ASSUME_ES5||c$fun==typeof Object.create?Object.create:function(b){var n=function(){};n[c$pr]=b;return new n};x$.underscoreProtoCanBeSet=function(){var b={a:!0},n={};try{return n.__proto__=b,n.a}catch(h){}return!1};x$.setPrototypeOf=c$fun==typeof Object.setPrototypeOf?Object.setPrototypeOf:x$.underscoreProtoCanBeSet()?function(b,n){b.__proto__=n;if(b.__proto__!==n)throw new TypeError(b+" is not extensible");return b}:null;
x$.i=function(b,n){b[c$pr]=x$.objectCreate(n[c$pr]);b[c$pr].constructor=b;if(x$.setPrototypeOf){var h=x$.setPrototypeOf;h(b,n)}else for(h in n)if(c$pr!=h)if(Object.defineProperties){var l=Object.getOwnPropertyDescriptor(n,h);l&&Object.defineProperty(b,h,l)}else b[h]=n[h];b.superClass_=n[c$pr]};
x$.findInternal=function(b,n,h){b instanceof String&&(b=String(b));for(var l=b.length,f=0;f<l;f++){var t=b[f];if(n.call(h,t,f,b))return{i:f,v:t}}return{i:-1,v:void 0}};x$.defineProperty=x$.ASSUME_ES5||c$fun==typeof Object.defineProperties?Object.defineProperty:function(b,n,h){b!=Array[c$pr]&&b!=Object[c$pr]&&(b[n]=h.value)};x$.getGlobal=function(b){return c$und!=typeof window&&window===b?b:c$und!=typeof global&&null!=global?global:b};x$.global=x$.getGlobal(this);
x$.polyfill=function(b,n,h,l){if(n){h=x$.global;b=b.split(".");for(l=0;l<b.length-1;l++){var f=b[l];f in h||(h[f]={});h=h[f]}b=b[b.length-1];l=h[b];n=n(l);n!=l&&null!=n&&x$.defineProperty(h,b,{configurable:!0,writable:!0,value:n})}};x$.polyfill("Array[c$pr].find",function(b){return b?b:function(b,h){return x$.findInternal(this,b,h).v}},"es6","es3");x$.SYMBOL_PREFIX="jscomp_symbol_";
x$.s=function(){x$.s=function(){};x$.global.Symbol||(x$.global.Symbol=x$.Symbol)};x$.Symbol=function(){var b=0;return function(n){return x$.SYMBOL_PREFIX+(n||"")+b++}}();
x$.sIterator=function(){x$.s();var b=x$.global.Symbol.iterator;b||(b=x$.global.Symbol.iterator=x$.global.Symbol("iterator"));c$fun!=typeof Array[c$pr][b]&&x$.defineProperty(Array[c$pr],b,{configurable:!0,writable:!0,value:function(){return x$.iteratorPrototype(x$.arrayIteratorImpl(this))}});x$.sIterator=function(){}};
x$.sAsyncIterator=function(){x$.s();var b=x$.global.Symbol.asyncIterator;b||(b=x$.global.Symbol.asyncIterator=x$.global.Symbol("asyncIterator"));x$.sAsyncIterator=function(){}};x$.iteratorPrototype=function(b){x$.sIterator();b={next:b};b[x$.global.Symbol.iterator]=function(){return this};return b};
x$.iteratorFromArray=function(b,n){x$.sIterator();b instanceof String&&(b+="");var h=0,l={next:function(){if(h<b.length){var f=h++;return{value:n(f,b[f]),done:!1}}l.next=function(){return{done:!0,value:void 0}};return l.next()}};l[Symbol.iterator]=function(){return l};return l};x$.polyfill("Array[c$pr].keys",function(b){return b?b:function(){return x$.iteratorFromArray(this,function(b){return b})}},"es6","es3");
x$.owns=function(b,n){return Object[c$pr].hasOwnProperty.call(b,n)};x$.assign=c$fun==typeof Object.assign?Object.assign:function(b,n){for(var h=1;h<arguments.length;h++){var l=arguments[h];if(l)for(var f in l)x$.owns(l,f)&&(b[f]=l[f])}return b};x$.polyfill("Object.assign",function(b){return b||x$.assign},"es6","es3");x$.FORCE_POLYFILL_PROMISE=!1;
x$.polyfill("Promise",function(b){function n(){this.batch_=null}function h(v){return v instanceof f?v:new f(function(b,A){b(v)})}if(b&&!x$.FORCE_POLYFILL_PROMISE)return b;n[c$pr].asyncExecute=function(v){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(v);return this};n[c$pr].asyncExecuteBatch_=function(){var v=this;this.asyncExecuteFunction(function(){v.executeBatch_()})};var l=x$.global.setTimeout;n[c$pr].asyncExecuteFunction=function(v){l(v,
0)};n[c$pr].executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var v=this.batch_;this.batch_=[];for(var b=0;b<v.length;++b){var A=v[b];v[b]=null;try{A()}catch(g){this.asyncThrow_(g)}}}this.batch_=null};n[c$pr].asyncThrow_=function(v){this.asyncExecuteFunction(function(){throw v;})};var f=function(v){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{v(b.resolve,b.reject)}catch(A){b.reject(A)}};f[c$pr].createResolveAndReject_=
function(){function v(g){return function(a){A||(A=!0,g.call(b,a))}}var b=this,A=!1;return{resolve:v(this.resolveTo_),reject:v(this.reject_)}};f[c$pr].resolveTo_=function(v){if(v===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(v instanceof f)this.settleSameAsPromise_(v);else{a:switch(typeof v){case c$obj:var b=null!=v;break a;case c$fun:b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(v):this.fulfill_(v)}};f[c$pr].resolveToNonPromiseObj_=function(v){var b=
void 0;try{b=v.then}catch(A){this.reject_(A);return}c$fun==typeof b?this.settleSameAsThenable_(b,v):this.fulfill_(v)};f[c$pr].reject_=function(b){this.settle_(2,b)};f[c$pr].fulfill_=function(b){this.settle_(1,b)};f[c$pr].settle_=function(b,t){if(0!=this.state_)throw Error("Cannot settle("+b+", "+t+"): Promise already settled in state"+this.state_);this.state_=b;this.result_=t;this.executeOnSettledCallbacks_()};f[c$pr].executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var b=
0;b<this.onSettledCallbacks_.length;++b)t.asyncExecute(this.onSettledCallbacks_[b]);this.onSettledCallbacks_=null}};var t=new n;f[c$pr].settleSameAsPromise_=function(b){var v=this.createResolveAndReject_();b.callWhenSettled_(v.resolve,v.reject)};f[c$pr].settleSameAsThenable_=function(b,t){var A=this.createResolveAndReject_();try{b.call(t,A.resolve,A.reject)}catch(g){A.reject(g)}};f[c$pr].then=function(b,t){function A(c,d){return c$fun==typeof c?function(d){try{g(c(d))}catch(p){a(p)}}:
d}var g,a,d=new f(function(c,d){g=c;a=d});this.callWhenSettled_(A(b,g),A(t,a));return d};f[c$pr].catch=function(b){return this.then(void 0,b)};f[c$pr].callWhenSettled_=function(b,h){function A(){switch(g.state_){case 1:b(g.result_);break;case 2:h(g.result_);break;default:throw Error("Unexpected state: "+g.state_);}}var g=this;null==this.onSettledCallbacks_?t.asyncExecute(A):this.onSettledCallbacks_.push(A)};f.resolve=h;f.reject=function(b){return new f(function(t,A){A(b)})};f.race=function(b){return new f(function(t,
A){for(var g=x$.m(b),a=g.next();!a.done;a=g.next())h(a.value).callWhenSettled_(t,A)})};f.all=function(b){var t=x$.m(b),A=t.next();return A.done?h([]):new f(function(g,a){function d(a){return function(d){c[a]=d;e--;0==e&&g(c)}}var c=[],e=0;do c.push(void 0),e++,h(A.value).callWhenSettled_(d(c.length-1),a),A=t.next();while(!A.done)})};return f},"es6","es3");
x$.checkEs6ConformanceViaProxy=function(){try{var b={},n=Object.create(new x$.global.Proxy(b,{get:function(h,l,f){return h==b&&"q"==l&&f==n}}));return!0===n.q}catch(h){return!1}};x$.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;x$.ES6_CONFORMANCE=x$.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&x$.checkEs6ConformanceViaProxy();
x$.polyfill("WeakMap",function(b){function n(){if(!b||!Object.seal)return!1;try{var A=Object.seal({}),g=Object.seal({}),a=new b([[A,2],[g,3]]);if(2!=a.get(A)||3!=a.get(g))return!1;a.delete(A);a.set(g,4);return!a.has(A)&&4==a.get(g)}catch(d){return!1}}function h(){}function l(b){if(!x$.owns(b,t)){var g=new h;x$.defineProperty(b,t,{value:g})}}function f(b){var g=Object[b];g&&(Object[b]=function(a){if(a instanceof h)return a;l(a);return g(a)})}if(x$.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(b&&
x$.ES6_CONFORMANCE)return b}else if(n())return b;var t="x$_hidden_"+Math.random();f("freeze");f("preventExtensions");f("seal");var v=0,z=function(b){this.id_=(v+=Math.random()+1).toString();if(b){b=x$.m(b);for(var g;!(g=b.next()).done;)g=g.value,this.set(g[0],g[1])}};z[c$pr].set=function(b,g){l(b);if(!x$.owns(b,t))throw Error("WeakMap key fail: "+b);b[t][this.id_]=g;return this};z[c$pr].get=function(b){return x$.owns(b,t)?b[t][this.id_]:void 0};z[c$pr].has=
function(b){return x$.owns(b,t)&&x$.owns(b[t],this.id_)};z[c$pr].delete=function(b){return x$.owns(b,t)&&x$.owns(b[t],this.id_)?delete b[t][this.id_]:!1};return z},"es6","es3");x$.MapEntry=function(){};
x$.polyfill("Map",function(b){function n(){if(x$.ASSUME_NO_NATIVE_MAP||!b||c$fun!=typeof b||!b[c$pr].entries||c$fun!=typeof Object.seal)return!1;try{var t=Object.seal({x:4}),g=new b(x$.m([[t,"s"]]));if("s"!=g.get(t)||1!=g.size||g.get({x:4})||g.set({x:4},"t")!=g||2!=g.size)return!1;var a=g.entries(),d=a.next();if(d.done||d.value[0]!=t||"s"!=d.value[1])return!1;d=a.next();return d.done||4!=d.value[0].x||"t"!=d.value[1]||!a.next().done?!1:!0}catch(c){return!1}}
if(x$.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(b&&x$.ES6_CONFORMANCE)return b}else if(n())return b;x$.sIterator();var h=new WeakMap,l=function(b){this.data_={};this.head_=v();this.size=0;if(b){b=x$.m(b);for(var g;!(g=b.next()).done;)g=g.value,this.set(g[0],g[1])}};l[c$pr].set=function(b,g){b=0===b?0:b;var a=f(this,b);a.list||(a.list=this.data_[a.id]=[]);a.entry?a.entry.value=g:(a.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:b,
value:g},a.list.push(a.entry),this.head_.previous.next=a.entry,this.head_.previous=a.entry,this.size++);return this};l[c$pr].delete=function(b){b=f(this,b);return b.entry&&b.list?(b.list.splice(b.index,1),b.list.length||delete this.data_[b.id],b.entry.previous.next=b.entry.next,b.entry.next.previous=b.entry.previous,b.entry.head=null,this.size--,!0):!1};l[c$pr].clear=function(){this.data_={};this.head_=this.head_.previous=v();this.size=0};l[c$pr].has=function(b){return!!f(this,b).entry};
l[c$pr].get=function(b){return(b=f(this,b).entry)&&b.value};l[c$pr].entries=function(){return t(this,function(b){return[b.key,b.value]})};l[c$pr].keys=function(){return t(this,function(b){return b.key})};l[c$pr].values=function(){return t(this,function(b){return b.value})};l[c$pr].forEach=function(b,g){for(var a=this.entries(),d;!(d=a.next()).done;)d=d.value,b.call(g,d[1],d[0],this)};l[c$pr][Symbol.iterator]=l[c$pr].entries;var f=function(b,g){var a=g&&typeof g;c$obj==
a||c$fun==a?h.has(g)?a=h.get(g):(a=""+ ++z,h.set(g,a)):a="p_"+g;var d=b.data_[a];if(d&&x$.owns(b.data_,a))for(b=0;b<d.length;b++){var c=d[b];if(g!==g&&c.key!==c.key||g===c.key)return{id:a,list:d,index:b,entry:c}}return{id:a,list:d,index:-1,entry:void 0}},t=function(b,g){var a=b.head_;return x$.iteratorPrototype(function(){if(a){for(;a.head!=b.head_;)a=a.previous;for(;a.next!=a.head;)return a=a.next,{done:!1,value:g(a)};a=null}return{done:!0,value:void 0}})},v=function(){var b={};return b.previous=
b.next=b.head=b},z=0;return l},"es6","es3");
$tgwbpk([1],{100:function(b,n,h){var l,f;!(l=[h(1),h(81),h(82),h(20),h(179),h(173),h(174),h(175),h(176),h(177),h(180),h(318),h(15),h(181),h(49),h(83),h(19),h(13),h(46),h(7),h(22)],f=function(b,v,h,f,g,a,d,c,e,k,p,m,w,x,r,B,u){function t(a,c){return u(a,"table")&&u(11!==c.nodeType?c:c.firstChild,"tr")?b(">tbody",a)[0]||a:a}function q(a){a.type=(null!==a.getAttribute("type"))+"/"+a.type;return a}function y(a){var c=l.exec(a.type);c?a.type=c[1]:a.removeAttribute("type");return a}function E(a,c){var m,
d;if(1===c.nodeType){if(w.hasData(a)){var e=w.access(a);var q=w.set(c,e);if(e=e.events)for(d in delete q.handle,q.events={},e)for(q=0,m=e[d].length;q<m;q++)b.event.add(c,d,e[d][q])}x.hasData(a)&&(a=x.access(a),a=b.extend({},a),x.set(c,a))}}function F(a,c,k,g){c=v.apply([],c);var r,u=0,x=a.length,E=x-1,h=c[0],t=b.isFunction(h);if(t||1<x&&"string"===typeof h&&!m.checkClone&&A.test(h))return a.each(function(m){var d=a.eq(m);t&&(c[0]=h.call(this,m,d.html()));F(d,c,k,g)});if(x){var f=p(c,a[0].ownerDocument,
!1,a,g);var C=f.firstChild;1===f.childNodes.length&&(f=C);if(C||g){C=b.map(e(f,"script"),q);for(r=C.length;u<x;u++){var D=f;u!==E&&(D=b.clone(D,!0,!0),r&&b.merge(C,e(D,"script")));k.call(a[u],D,u)}if(r)for(f=C[C.length-1].ownerDocument,b.map(C,y),u=0;u<r;u++)D=C[u],d.test(D.type||"")&&!w.access(D,"globalEval")&&b.contains(f,D)&&(D.src?b._evalUrl&&b._evalUrl(D.src):B(D.textContent.replace(n,""),f))}}return a}function D(a,c,m){for(var d=c?b.filter(c,a):a,q=0;null!=(c=d[q]);q++)m||1!==c.nodeType||b.cleanData(e(c)),
c.parentNode&&(m&&b.contains(c.ownerDocument,c)&&k(e(c,"script")),c.parentNode.removeChild(c));return a}var I=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,z=/<script|<style|<link/i,A=/checked\s*(?:[^=]|=\s*.checked.)/i,l=/^true\/(.*)/,n=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;b.extend({htmlPrefilter:function(a){return a.replace(I,"<$1></$2>")},clone:function(a,c,d){var q,p=a.cloneNode(!0),y=b.contains(a.ownerDocument,a);if(!(m.noCloneChecked||1!==
a.nodeType&&11!==a.nodeType||b.isXMLDoc(a))){var w=e(p);var r=e(a);var u=0;for(q=r.length;u<q;u++){var x=r[u],B=w[u],v=B.nodeName.toLowerCase();if("input"===v&&g.test(x.type))B.checked=x.checked;else if("input"===v||"textarea"===v)B.defaultValue=x.defaultValue}}if(c)if(d)for(r=r||e(a),w=w||e(p),u=0,q=r.length;u<q;u++)E(r[u],w[u]);else E(a,p);w=e(p,"script");0<w.length&&k(w,!y&&e(a,"script"));return p},cleanData:function(a){for(var c,m,d,e=b.event.special,q=0;void 0!==(m=a[q]);q++)if(r(m)){if(c=m[w.expando]){if(c.events)for(d in c.events)e[d]?
b.event.remove(m,d):b.removeEvent(m,d,c.handle);m[w.expando]=void 0}m[x.expando]&&(m[x.expando]=void 0)}}});b.fn.extend({detach:function(a){return D(this,a,!0)},remove:function(a){return D(this,a)},text:function(a){return f(this,function(a){return void 0===a?b.text(this):this.empty().each(function(){if(1===this.nodeType||11===this.nodeType||9===this.nodeType)this.textContent=a})},null,a,arguments.length)},append:function(){return F(this,arguments,function(a){1!==this.nodeType&&11!==this.nodeType&&
9!==this.nodeType||t(this,a).appendChild(a)})},prepend:function(){return F(this,arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var c=t(this,a);c.insertBefore(a,c.firstChild)}})},before:function(){return F(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return F(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},empty:function(){for(var a,c=0;null!=(a=this[c]);c++)1===
a.nodeType&&(b.cleanData(e(a,!1)),a.textContent="");return this},clone:function(a,c){a=null==a?!1:a;c=null==c?a:c;return this.map(function(){return b.clone(this,a,c)})},html:function(m){return f(this,function(m){var d=this[0]||{},q=0,k=this.length;if(void 0===m&&1===d.nodeType)return d.innerHTML;if("string"===typeof m&&!z.test(m)&&!c[(a.exec(m)||["",""])[1].toLowerCase()]){m=b.htmlPrefilter(m);try{for(;q<k;q++)d=this[q]||{},1===d.nodeType&&(b.cleanData(e(d,!1)),d.innerHTML=m);d=0}catch(K){}}d&&this.empty().append(m)},
null,m,arguments.length)},replaceWith:function(){var a=[];return F(this,arguments,function(c){var m=this.parentNode;0>b.inArray(this,a)&&(b.cleanData(e(this)),m&&m.replaceChild(c,this))},a)}});b.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,c){b.fn[a]=function(a){for(var m=[],d=b(a),e=d.length-1,q=0;q<=e;q++)a=q===e?this:this.clone(!0),b(d[q])[c](a),h.apply(m,a.get());return this.pushStack(m)}});return b}.apply(n,l),void 0!==
f&&(b.exports=f))},173:function(b,n,h){n=/<([a-z][^\/\0>\x20\t\r\n\f]+)/i;!(void 0!==n&&(b.exports=n))},174:function(b,n,h){n=/^$|\/(?:java|ecma)script/i;!(void 0!==n&&(b.exports=n))},175:function(b,n,h){n={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};n.optgroup=n.option;n.tbody=n.tfoot=n.colgroup=
n.caption=n.thead;n.th=n.td;!(void 0!==n&&(b.exports=n))},176:function(b,n,h){var l,f;!(l=[h(1),h(19)],f=function(b,v){return function(h,f){var g=c$und!==typeof h.getElementsByTagName?h.getElementsByTagName(f||"*"):c$und!==typeof h.querySelectorAll?h.querySelectorAll(f||"*"):[];return void 0===f||f&&v(h,f)?b.merge([h],g):g}}.apply(n,l),void 0!==f&&(b.exports=f))},177:function(b,n,h){var l,f;!(l=[h(15)],f=function(b){return function(v,h){for(var f=0,g=v.length;f<g;f++)b.set(v[f],"globalEval",
!h||b.get(h[f],"globalEval"))}}.apply(n,l),void 0!==f&&(b.exports=f))},178:function(b,n,h){var l,f;!(l=[h(1),h(13),h(100),h(46)],f=function(b){b.fn.extend({wrapAll:function(f){this[0]&&(b.isFunction(f)&&(f=f.call(this[0])),f=b(f,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&f.insertBefore(this[0]),f.map(function(){for(var b=this;b.firstElementChild;)b=b.firstElementChild;return b}).append(this));return this},wrapInner:function(f){return b.isFunction(f)?this.each(function(h){b(this).wrapInner(f.call(this,
h))}):this.each(function(){var h=b(this),v=h.contents();v.length?v.wrapAll(f):h.append(f)})},wrap:function(f){var h=b.isFunction(f);return this.each(function(v){b(this).wrapAll(h?f.call(this,v):f)})},unwrap:function(f){this.parent(f).not("body").each(function(){b(this).replaceWith(this.childNodes)});return this}});return b}.apply(n,l),void 0!==f&&(b.exports=f))},179:function(b,n,h){n=/^(?:checkbox|radio)$/i;!(void 0!==n&&(b.exports=n))},180:function(b,n,h){var l,f;!(l=[h(1),h(173),h(174),h(175),h(176),
h(177)],f=function(b,f,h,l,g,a){var d=/<|&#?\w+;/;return function(c,e,k,p,m){for(var w,x,r,B=e.createDocumentFragment(),u=[],C=0,q=c.length;C<q;C++)if((w=c[C])||0===w)if(c$obj===b.type(w))b.merge(u,w.nodeType?[w]:w);else if(d.test(w)){x=x||B.appendChild(e.createElement("div"));r=(f.exec(w)||["",""])[1].toLowerCase();r=l[r]||l._default;x.innerHTML=r[1]+b.htmlPrefilter(w)+r[2];for(r=r[0];r--;)x=x.lastChild;b.merge(u,x.childNodes);x=B.firstChild;x.textContent=""}else u.push(e.createTextNode(w));B.textContent=
"";for(C=0;w=u[C++];)if(p&&-1<b.inArray(w,p))m&&m.push(w);else if(c=b.contains(w.ownerDocument,w),x=g(B.appendChild(w),"script"),c&&a(x),k)for(r=0;w=x[r++];)h.test(w.type||"")&&k.push(w);return B}}.apply(n,l),void 0!==f&&(b.exports=f))},181:function(b,n,h){var l,f;!(l=[h(84)],f=function(b){return new b}.apply(n,l),void 0!==f&&(b.exports=f))},183:function(b,n,h){n.__esModule=!0;var l=h(436),f=h(2),t=h(480),v=h(9),z=h(443);b=function(b,g){var a=z.default.call(this,b,g,!1)||this;a.media_settings=new l.default.MediaSettings(b.app);
a.call_sound=null;a.app.getSound("call",function(c){a.call_sound=c});a.clientPopState=f.default.observable(!1);a.clientPopState.subscribe(function(){for(var c=x$.m(a.users()),d=c.next();!d.done;d=c.next()){d=d.value;if("standby"!=d.status())if(b.isClientPopupVideoSupport(!0))d.msg("rtc_full_screen",a.clientPopState());else break;"standby"!=d.screen_status()&&d.msg("screen_full_screen",a.clientPopState())}});a.recording=a.app.account().settings.video_recording;a.recording="1"==a.recording||
"on"==a.recording;g=a.app.settings().exclude_agents_from_recording;g="string"===typeof g&&g?g.split(","):[];a.excluded_recording=0<=g.indexOf(a.app.myself().id+"");a._req={};a.call_time=f.default.observable(0);a.timeEc=f.default.computed(function(){var c=Math.floor(a.call_time()/3600),d=Math.floor((a.call_time()-3600*c)/60),k=a.call_time()-3600*c-60*d;return c+":"+d+":"+k});var d=setInterval(function(){a.call_time&&a.call_time()&&0!==a.call_time()&&a.call_time(a.call_time()+1)},1E3);a.on("dispose",
function(){clearInterval(d)});a.incall=v.default.createReadableComputed(function(){return a.myself()?"standby"!==a.myself().status():!1},!1);a.inscreencall=v.default.createReadableComputed(function(){return a.myself()?"standby"!==a.myself().screen_status():!1},!1);a.fullscreen=f.default.observable(!1);a.fullscreen.subscribe(function(){c$und!=typeof a.chat.active_tab&&(a.fullscreen()?a.chat.active_tab("rtc"):a.chat.active_tab("chat"))});a.settings_popup=f.default.observable(!1);a.settings_update=
function(){this.myself()&&this.incall()&&this.myself().__last_hash!==this.media_settings.getHash()&&this.myself().updateStreams();this.settings_popup(!1)};a.settings_popup.subscribe(function(){a.app.frameMananger(function(c){a.app.ui.theme.templates["camera-settings"](function(d){c.getPopUP("camera-settings",d,function(c,d){if(a.settings_popup())a.media_settings.checkDevices(function(){f.default.dataFor(d[0])||f.default.applyBindings(a,d[0]);c.show()});else{for(var m=x$.m(a.media_settings.stream_dispose),
e=m.next();!e.done;e=m.next())e=e.value,e();c.hide()}a.on("dispose",function(){c&&c.remove()})})})})});a.rtcUsers=v.default.createReadableComputed(function(c){for(var d=c.peek(),k=x$.m(a.users()),b=k.next();!b.done;b=k.next())b=b.value,("joined"==b.status()||"incall"==b.status())&&0>d.indexOf(b)?c.push(b):"joined"!==b.status()&&"incall"!==b.status()&&0<=d.indexOf(b)&&c.remove(b)},[]);a.rtcAUsers=f.default.computed(function(){return a.rtcUsers().filter(function(c){return a.activeInRoom()!==
c})});a.callType=v.default.createReadableComputed(function(c){for(var d=x$.m(a.users()),k=d.next();!k.done;k=d.next()){k=k.value;if(0<=k.stream_type().indexOf("video")||0<=k.stream_type().indexOf("video_only")){c="video";break}if(0<=k.stream_type().indexOf("audio")||0<=k.stream_type().indexOf("audio_only")){c="video"==c?c:"audio";break}}if(a.myself()){if(0<=a.myself().stream_type().indexOf("video")||0<=a.myself().stream_type().indexOf("video_only"))c="video";if(0<=a.myself().stream_type().indexOf("audio")||
0<=a.myself().stream_type().indexOf("audio_only"))c="video"==c?c:"audio"}return null!=c&&"audio"!=c||"video"!=a.app.account().settings.agent_default_call_pick_type&&"ask"!=a.app.account().settings.agent_default_call_pick_type?c:"video"},null);a.screenUsers=f.default.computed(function(){for(var c=[],d=x$.m(a.users()),k=d.next();!k.done;k=d.next())k=k.value,"joined"==k.screen_status()&&c.push(k);a.chat&&a.app&&"frontend"==a.app.type&&(0<c.length?a.app.popUpMananger(function(a){0>a.sections.indexOf("screen")&&
a.sections.push("screen")}):a.app.popUpMananger(function(a){a.sections.remove("screen")}));return c});a.doChromeExtInstall=f.default.observable(!1);a._activeInRoom=f.default.observable();a.activeInRoom=f.default.computed({read:function(){if(a._activeInRoom()===a.myself())return a._activeInRoom();if(0==a.rtcUsers().length)return a._activeInRoom(null),null;(!a._activeInRoom()||0>a.rtcUsers().indexOf(a._activeInRoom()))&&window.parserResult&&"Mobile Safari"!=window.parserResult.browser.name&&a._activeInRoom(a.rtcUsers()[0]);
return a._activeInRoom()},write:function(c){a._activeInRoom(c)}});a.rtcScreenAUsers=f.default.computed(function(){for(var c=[],d=x$.m(a.screenUsers()),k=d.next();!k.done;k=d.next())k=k.value,a.activeScreenRoom()!==k&&c.push(k);return c});a._activeScreenRoom=f.default.observable();a.activeScreenRoom=f.default.computed({read:function(){if(0==a.screenUsers().length)return a._activeScreenRoom(null),null;a._activeScreenRoom()||a._activeScreenRoom(a.screenUsers()[0]);return a._activeScreenRoom()},
write:function(c){a._activeScreenRoom(c)}});a.incall.subscribe(function(){a.incall()?0===a.call_time()&&a.call_time(1):a.call_time(0);a.app.trigger("rtcroom-incall",a.incall())});a.app.trigger("rtcroom-incall",a.incall());a.app.socket&&a.app.socket.emit("rtc_turn_servers",function(a,d,k){if(void 0===k?0:k)l.default.forceTurnServer=!0,l.default.PeerConnectionConfig.iceServers=[];if(a)return console.error(a);d=d?d.concat(l.default.PeerConnectionConfig.iceServers):l.default.PeerConnectionConfig.iceServers;
window.parserResult&&"Edge"==window.parserResult.browser.name&&(l.default.PeerConnectionConfig.bundlePolicy="max-bundle");l.default.PeerConnectionConfig.iceServers=d});a.if("ready",function(){a.app.trigger("rtcroom",a,a.myself())});return a};x$.i(b,z.default);b.getName=function(){return"rtcroom"};b[c$pr].getUserClass=function(){return t.default};b[c$pr].onDispose=function(){this.call_sound&&this.call_sound.pause();this.media_settings.onDispose();this.myself&&this.myself()&&(this.myself().stopRTCCall(),
this.myself().stopScreenCall());z.default[c$pr].onDispose.call(this)};b[c$pr].refreshMyRTCStatus=function(){for(var b=!1,g=x$.m(this.users()),a=g.next();!a.done;a=g.next())if(a=a.value,"joined"===a.status()||"incall"===a.status())b=!0;!b&&this.myself()&&(this.myself().status("standby"),this.myself().stopRTCCall(!1),this.chat.app.popUpMananger(function(a){a.sections.remove("rtcroom")}));"standby"===this.myself().status()&&this.fullscreen(!1)};b[c$pr].refreshMyScreenStatus=
function(){for(var b=!1,g=x$.m(this.users()),a=g.next();!a.done;a=g.next())"standby"!==a.value.screen_status()&&(b=!0);!b&&this.myself()&&(this.myself().screen_status("standby"),this.myself().stopScreenCall(!1),this.chat.app.popUpMananger(function(a){a.sections.remove("screen")}))};n.default=b},318:function(b,n,h){var l,f;!(l=[h(3),h(30)],f=function(b,f){var h=b.createDocumentFragment().appendChild(b.createElement("div"));b=b.createElement("input");b.setAttribute("type","radio");b.setAttribute("checked",
"checked");b.setAttribute("name","t");h.appendChild(b);f.checkClone=h.cloneNode(!0).cloneNode(!0).lastChild.checked;h.innerHTML="<textarea>x</textarea>";f.noCloneChecked=!!h.cloneNode(!0).lastChild.defaultValue;return f}.apply(n,l),void 0!==f&&(b.exports=f))},319:function(b,n,h){var l,f;!(l=[h(1)],f=function(b){return function(f,h,t){for(var g=[],a=void 0!==t;(f=f[h])&&9!==f.nodeType;)if(1===f.nodeType){if(a&&b(f).is(t))break;g.push(f)}return g}}.apply(n,l),void 0!==f&&(b.exports=f))},320:function(b,
n,h){var l;!(l=function(){return function(b,h){for(var f=[];b;b=b.nextSibling)1===b.nodeType&&b!==h&&f.push(b);return f}}.call(n,h,n,b),void 0!==l&&(b.exports=l))},321:function(b,n,h){var l,f;!(l=[h(1),h(20),h(3),h(48),h(50),h(87),h(88),h(51),h(19),h(13),h(21),h(7)],f=function(b,f,h,l,g,a,d,c,e){b.offset={setOffset:function(a,c,d){var m=b.css(a,"position"),e=b(a),k={};"static"===m&&(a.style.position="relative");var g=e.offset();var p=b.css(a,"top");var f=b.css(a,"left");("absolute"===m||"fixed"===
m)&&-1<(p+f).indexOf("auto")?(f=e.position(),p=f.top,f=f.left):(p=parseFloat(p)||0,f=parseFloat(f)||0);b.isFunction(c)&&(c=c.call(a,d,b.extend({},g)));null!=c.top&&(k.top=c.top-g.top+p);null!=c.left&&(k.left=c.left-g.left+f);"using"in c?c.using.call(a,k):e.css(k)}};b.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(c){b.offset.setOffset(this,a,c)});var c;if(c=this[0]){if(!c.getClientRects().length)return{top:0,left:0};var d=c.getBoundingClientRect();var e=
c.ownerDocument;c=e.documentElement;e=e.defaultView;return{top:d.top+e.pageYOffset-c.clientTop,left:d.left+e.pageXOffset-c.clientLeft}}},position:function(){if(this[0]){var a=this[0],c={top:0,left:0};if("fixed"===b.css(a,"position"))var d=a.getBoundingClientRect();else{var g=this.offsetParent();d=this.offset();e(g[0],"html")||(c=g.offset());c={top:c.top+b.css(g[0],"borderTopWidth",!0),left:c.left+b.css(g[0],"borderLeftWidth",!0)}}return{top:d.top-c.top-b.css(a,"marginTop",!0),left:d.left-c.left-b.css(a,
"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent;a&&"static"===b.css(a,"position");)a=a.offsetParent;return a||l})}});b.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,c){var d="pageYOffset"===c;b.fn[a]=function(m){return f(this,function(a,m,e){if(b.isWindow(a))var k=a;else 9===a.nodeType&&(k=a.defaultView);if(void 0===e)return k?k[c]:a[m];k?k.scrollTo(d?k.pageXOffset:e,d?e:k.pageYOffset):a[m]=e},a,m,arguments.length)}});b.each(["top",
"left"],function(e,p){b.cssHooks[p]=d(c.pixelPosition,function(c,d){if(d)return d=a(c,p),g.test(d)?b(c).position()[p]+"px":d})});return b}.apply(n,l),void 0!==f&&(b.exports=f))},434:function(b,n,h){n.__esModule=!0;var l=h(10),f=h(11),t=h(9);b=function(b,h){var v=this;f.default.create(this);this.id=b;this.module=h;this._state=null;this.self=h.channel.details.id==b;var g=l.default.trackTimeEvent("p2p","peer-join");this.on("join",function(a,d){g();v._state=a});this.on("leave",function(){v._state=null});
this.module.channel.on("disconnect",function(){v._state=null})};b[c$pr].onDestroy=function(){for(var b in this)t.default.disposeKoItem(this[b]),delete this[b]};b[c$pr].onMsg=function(b,f){};b[c$pr].msg=function(b,f){for(var h=[],g=1;g<arguments.length;++g)h[g-1]=arguments[g];var a=this;if(this.self)h.unshift(b),this.trigger.apply(this,h),this.onMsg.apply(this,h);else if(this.module&&this.module.chat)if(this.module.start(),this._state)this.module.channel.msg(this._state,b,h);else this.once("join",
function(d,c){a.module.channel.msg(d,b,h)})};n.default=b},436:function(b,n,h){n.__esModule=!0;var l=h(2),f=h(12);b=c$und!==typeof RTCPeerConnection&&null!==RTCPeerConnection;h=function(b){var f=this;this.app=b;this.audioInputs=l.default.observableArray([]);this.audioOutputs=l.default.observableArray([]);this.videoCameras=l.default.observableArray([]);this.qualityList=l.default.observableArray([{id:"low",label:"Low"},{id:"high",label:"High"}]);this.sampleVideoElement=l.default.observable(null);
this.deviceDefaultComputed=function(b,g,a){a=void 0===a?null:a;var d=l.default.observable(localStorage.getItem(b+"-device")||a);return l.default.computed({read:function(){for(var a=x$.m(g()),b=a.next();!b.done;b=a.next())if(b=b.value,b.id==d())return b.id;return d()},write:function(a){a=void 0===a?null:a;d(a||null);null===a?localStorage.removeItem(b+"-device"):localStorage.setItem(b+"-device",a)},deferEvaluation:!0})};this.stream_dispose=[];this.audioInputDefault=this.deviceDefaultComputed("audio",
this.audioInputs);this.audioOutputDefault=this.deviceDefaultComputed("speaker",this.audioOutputs);this.videoCameraDefault=this.deviceDefaultComputed("video",this.videoCameras);this.videoQualityDefault=this.deviceDefaultComputed("quality",this.qualityList,0==acquireIO.settings().hdClient?"low":"high","high");this.sampleVideoElementUpdate=l.default.computed(function(){var b=f.sampleVideoElement(),g=f.audioInputDefault(),a=f.audioOutputDefault(),d=f.videoCameraDefault();if(b){g={audio:{deviceId:g?{exact:g}:
void 0},video:{deviceId:d?{exact:d}:void 0}};d=x$.m(f.stream_dispose);for(var c=d.next();!c.done;c=d.next())c=c.value,c();navigator.mediaDevices.getUserMedia(g).then(function(c){for(var d=x$.m(f.stream_dispose),e=d.next();!e.done;e=d.next())e=e.value,e();f.stream_dispose.push(function(){if(null!=c){try{c.getTracks().length&&c.getTracks()[0].stop&&c.getTracks().forEach(function(a){a.stop()})}catch(m){}try{c.stop()}catch(m){}c=null}});b.srcObject=c;c$und!==typeof b.sinkId&&
a&&b.setSinkId(a).then(function(){}).catch(function(a){this.audioOutputDefault(null)})}).catch(function(a){console.error("navigator.getUserMedia error: ",a)})}},this,{deferEvaluation:!0});this.checkDevices=function(b){navigator.mediaDevices.enumerateDevices().then(function(g){var a=[],d=[],c=[];g=x$.m(g);for(var e=g.next();!e.done;e=g.next())e=e.value,"audioinput"===e.kind?a.push({id:e.deviceId||e.id,label:e.label||"Microphone "+(a.length+1)}):"audiooutput"===e.kind?/Edge/.test(navigator.userAgent)||
d.push({id:e.deviceId||e.id,label:e.label||"Speaker "+(d.length+1)}):"videoinput"===e.kind&&c.push({id:e.deviceId||e.id,label:e.label||"Camera "+(c.length+1)});f.audioInputs(a);f.audioOutputs(d);f.videoCameras(c);f.sampleVideoElementUpdate();b()}).catch(function(b){console.error(b)})}};h[c$pr].getHash=function(){var b=localStorage.getItem("audio-device"),f=localStorage.getItem("video-device"),h=c$und===typeof acquireIO||acquireIO.settings()&&"0"==acquireIO.settings().video_recording;return b+
"-"+f+"-"+(h?1:0)};h[c$pr].onDispose=function(){for(var b=x$.m(this.stream_dispose),f=b.next();!f.done;f=b.next())f=f.value,f()};var t=function(){};t.checkFirefoxExtInstalled=function(b){var f=Math.random();window[f]=function(f){1==f||"1"===f?b(!0):b(!1)};window.parent.parent.postMessage("cocomm__sendMessgeBack('window[\\'"+f+"\\']('+(document.body.classList.contains('ff-tagove-ext-installed')?1:0)+')');","*")};t.getUserMediaStreams=function(b,h,l,g,a,d){g=void 0===g?!1:g;a=void 0===
a?null:a;d=c$und===typeof acquireIO||acquireIO.settings()&&"0"==acquireIO.settings().video_recording;var c=localStorage.getItem("audio-device"),e=localStorage.getItem("video-device"),k=c+"-"+e+"-"+(d?1:0),p=t.streams[h+"-"+b];p&&p.hash!==k&&(g=!0);if(g||!p||p.ended||!1===p.active||a){p&&p.dispose&&p.dispose();var m=[];t.streams[h+"-"+b]=function(a){m.push(a)};t.streams[h+"-"+b].hash=k;var w=function(a,c){c.dispose=function(){try{c.getTracks().length&&c.getTracks()[0].stop&&c.getTracks().forEach(function(a){a.stop()})}catch(D){}try{c.stop()}catch(D){}};
for(var d=x$.m(m),e=d.next();!e.done;e=d.next())e=e.value,e(null,c,a);t.streams[a+"-"+b]=c;t.streams[a+"-"+b].hash=k;l(null,c,a)},x=function(a){l(a);for(var c=x$.m(m),d=c.next();!d.done;d=c.next())d=d.value,d(a);t.streams[h+"-"+b]=null},r={},B={};e&&(r.deviceId={ideal:e});c&&(B.deviceId={ideal:c});d?(r.width={ideal:1280},r.height={ideal:720}):(r.width={ideal:640},r.height={ideal:480});/iPhone|iPad|iPod/i.test(navigator.userAgent)&&(delete r.width,delete r.height,delete r.mandatory,
r.width={ideal:640},r.height={ideal:480},B=!0);var u=function(a){var d=a.fallback;delete a.fallback;navigator.getUserMedia(a,function(a){a.localStream=!0;w(h,a)},function(m){e||c?(console.error(m),c=e=null,delete B.deviceId,delete r.deviceId,delete r.width,delete r.height,C()):(console.log("user media err. "+JSON.stringify(a)),console.log(m),m&&d?u(d):"video"==h?(f.default.alert(acquireIO.getTransMsg("Please allow access to webcam.")),console.error(m),x(acquireIO.getTransMsg("Please allow access to webcam."))):
"screen"==h?(f.default.alert(acquireIO.getTransMsg("Please allow access to screen sharing or might be your browser is not supported for screen sharing.")),x(m)):"audio"==h&&(f.default.alert(acquireIO.getTransMsg("Please allow access your microphone and speaker.")),x(m)))})};var C=function(){"screen"==h?window.acquireIO.extensionManager(function(a){var c=function(){-1!==navigator.userAgent.indexOf("Edge")&&(navigator.msSaveOrOpenBlob||navigator.msSaveBlob)?navigator.getDisplayMedia({video:{mandatory:{}}}).then(function(a){w("screen",
a)}).catch(function(a){p=t.streams[h+"-"+b]=void 0;console.error(a);f.default.alert(acquireIO.getTransMsg("Screen can't be captured."));x(acquireIO.getTransMsg("User denied"))}):a.getScreenShareSource(function(a,c){navigator.getUserMedia(c,function(a){w("screen",a)},function(d){p=t.streams[h+"-"+b]=void 0;var m=function(m){a?"browser-not-supported"==a?f.default.alert(acquireIO.getTransMsg("This browser is not supported for screen sharing.")):"extension-not-available"==a&&navigator.mediaDevices.getDisplayMedia({audio:!1,
video:{maxWidth:c.video.mandatory.maxWidth,maxHeight:c.video.mandatory.maxHeight}}).then(function(a){w("screen",a)}).catch(function(a){console.error("Error: "+d)}):(f.default.alert(acquireIO.getTransMsg("Screen sharing permissions denied.")),x(acquireIO.getTransMsg("User denied")))};try{try{window.desktop.screenShare(function(a){console.error(a);m()},function(a){w("screen",a)})}catch(G){navigator.getDisplayMedia({video:{mandatory:{}}}).then(function(a){w("screen",a)}).catch(m)}}catch(G){m(G)}})})};
try{if(c$obj==typeof window.process){var d=eval("require('nw.gui');");d.Screen.Init();d.Screen.chooseDesktopMedia(["window","screen"],function(a){navigator.webkitGetUserMedia({audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:a},optional:[]}},function(a){w("screem",a)},function(){alert(acquireIO.getTransMsg("Please allow screen sharing access"))})})}else c()}catch(F){c(),console.error(F)}}):"audio"==h?u({audio:B}):"video"==h&&u({video:r,audio:B})};C()}else if(c$fun==
typeof p)p(l);else return l(null,p,h)};t.filterCandidates=function(){};t.generateCallid=function(){for(var b="",f=0;5>f;f++)b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return b};t.lineSettings=function(b){return b};t.handleIceCandidates=function(b,f,h,g,a){b.onnegotiationneeded=function(c){a()};var d=0;b.onicecandidate=function(a){var c=!1;null!=a.candidate&&t.removeLocalCandidates&&(0<=a.candidate.candidate.indexOf("127.0.0.1")||0<=a.candidate.candidate.indexOf("localhost")||
0<=a.candidate.candidate.indexOf("192.168."))&&(c=!0);c||(d++,h(a.candidate))}};t.MediaSettings=h;t.streams={};t.IsAndroidChrome=!1;try{-1<navigator.userAgent.toLowerCase().indexOf("android")&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)&&(t.IsAndroidChrome=!0)}catch(v){}t.isEdge=-1!==navigator.userAgent.indexOf("Edge")&&(!!navigator.msSaveOrOpenBlob||!!navigator.msSaveBlob);t.isChrome=!!navigator.webkitGetUserMedia;t.isFirefox=!!navigator.mozGetUserMedia;t.webrtcSupported=
b;t.removeLocalCandidates=!1;t.forceTurnServer=!1;t.PeerConnectionConfig={iceServers:[{urls:["stun:stun.l.google.com:19302"]},{urls:["stun:stun1.l.google.com:19302"]},{urls:["stun:stun2.l.google.com:19302"]}]};t.PeerConnectionOptions={optional:[{DtlsSrtpKeyAgreement:!0},{RtpDataChannels:!1}]};n.default=t},442:function(b,n,h){n.__esModule=!0;h(11);var l=h(2),f=h(434);b=function(b,h,n,A){b=f.default.call(this,b,h)||this;b.user=n;b.client=l.default.observable(A);return b};x$.i(b,f.default);
n.default=b},443:function(b,n,h){n.__esModule=!0;var l=h(11),f=h(9),t=h(2),v=h(23),z=h(10),A=h(12);b=function(b,a,d){var c=this;d=void 0===d?!0:d;l.default.create(this);this.__type=this.constructor.getName();this.id=this.__type+"_"+b.id;this.state_id=this.__type+"_"+b.app.account().uid;this.chat=b;this.include_virtuals=d;this.app=b.app;this.channel=a;var e=z.default.trackTimeEvent("p2p-"+this.__type,"ready");this.once("ready",function(){e();c.channel.ready&&c.channel.join(c.id,c);c.channel.on("ready",
function(){c$und!=typeof c.channel&&c.channel.join(c.id,c)},c)},this.channel);this.tweak_users=t.default.observableArray([]);this.tweak_myself=t.default.observable(null);this.users=this.clients=this.createP2PClientList();this.myself=this.createP2PMyClient();this.usersGroup=this.createUserGroup(this.clients);setTimeout(function(){if(c.channel.ready)c.loadState();else c.channel.on("ready",c.loadState.bind(c),c)},0);this.usersShowList=t.default.computed(function(){for(var a=[],d={},m=x$.m(c.users()),
b=m.next();!b.done;b=m.next()){b=b.value;var e=b.user.id;c$und===typeof d[e]&&(a.push(b),d[e]={})}return a})};b[c$pr].ifReady=function(b){if(this.myself&&this.myself())b();else this.once("ready",b)};b[c$pr].anyClientOnline=function(){if(this.data()&&this.data().clients)for(var b=x$.m(this.data().clients),a=b.next();!a.done;a=b.next());this.app.p2p(function(a){})};b[c$pr].isClientAvailable=function(b,a){a=void 0===a?!1:a;return b&&b.client()&&!b.client().online?(a&&
A.default.alert("User unavailble","User is not online."),!1):!0};b[c$pr].loadState=function(){};b.hasRunningState=function(b,a){var d=b.type+"_"+this.getName()+"_"+b.account().uid;b.clientStorage.get(d,null,function(c){c=c?JSON.parse(c):null;a(c)},v.default.TYPE_TAGOVE)};b[c$pr].getState=function(b){var a=this,d=this.id+"_state_"+this.app.type;return this.app.clientStorage.get(d,null,function(c){try{var e=c?JSON.parse(c):null;b(e);a.__state=e;a.setState(e)}catch(k){console.error("state parse failed: "+
d),console.error(c),b(null)}},v.default.TYPE_TAGOVE)};b[c$pr].setState=function(b){this.__state=b=void 0===b?null:b;this.app.clientStorage.set(this.chat.app.type+"_"+this.state_id,null===b?b:JSON.stringify(b),108E3,v.default.TYPE_TAGOVE);return this.app.clientStorage.set(this.id+"_state_"+this.app.type,null===b?b:JSON.stringify(b),108E3,v.default.TYPE_TAGOVE)};b[c$pr].getUserClass=function(){};b[c$pr].createP2PMyClient=function(){var b=this,a=this.getUserClass();return f.default.createReadableComputed(function(d){if(b.tweak_myself())return b.tweak_myself();
if(b.chat&&b.chat.myself&&b.chat.myself()&&b.app.myself())for(var c in b.chat.myself().clients()){var e=b.chat.myself().clients()[c];c==b.app.myself().client.id&&(d.peek()?d.peek().client(e):(d(b.app.p2p().user(b,c,a,b.chat.myself(),e)),b.trigger("ready",b.app.p2p())))}else d.peek()&&(d.peek().trigger("dispose"),d(null))},null,!1)};b[c$pr].createUserGroup=function(b){return t.default.computed({read:function(){for(var a=[],d=x$.m(b()),c=d.next();!c.done;c=d.next()){c=c.value;for(var e=
!1,k=x$.m(a),p=k.next();!p.done;p=k.next())p=p.value,p.user&&c.user&&p.user.id==c.user.id&&(p.clients[c.id]=c,p.virtual=p.virtual||c.client().virtual,e=!0);e||(e={user:c.user,clients:{},virtual:c.client().virtual},e.clients[c.id]=c,a.push(e))}return a},deferEvaluation:!0})};b[c$pr].createP2PClientList=function(){var b=this,a=this.getUserClass();return f.default.createReadableComputed(function(d){if(b.tweak_users().length)return b.tweak_users();var c=d.peek(),e=[],k=function(m,
k,q){q.virtual=b.chat.data().users&&b.chat.data().users[m.id]?b.chat.data().users[m.id].virtual:!1;q.widget_state=m.data().widget_state&&c$und!==typeof m.data().widget_state.ui?m.data().widget_state.ui:!1;if(!q.virtual||b.include_virtuals){for(var y=!1,p=x$.m(c),r=p.next();!r.done;r=p.next())r=r.value,r.id==k&&(r.client(q),y=!0);y||d.push(b.app.p2p().user(b,k,a,m,q));e.push(k)}};if(b.chat&&b.chat.users){for(var p=x$.m(b.chat.users()),m=p.next();!m.done;m=p.next()){m=
m.value;for(var w in m.clients())k(m,w,m.clients()[w])}if(b.chat.myself&&b.chat.myself())for(var g in b.chat.myself().clients())p=b.chat.myself().clients()[g],g!=b.app.myself().client.id&&k(b.chat.myself(),g,p);for(k=c.length-1;0<=k;--k){g=c[k];p=!1;w=x$.m(b.chat.users());for(m=w.next();!m.done;m=w.next()){m=m.value;for(var r in m.clients())g.id==r&&(p=!0)}if(b.chat.myself&&b.chat.myself())for(var f in b.chat.myself().clients())f!==b.app.myself().client.id&&f===g.id&&(p=!0);p||(g.trigger("dispose"),
d.remove(g))}}return c},[],!1)};b[c$pr].onDispose=function(){if(this.users){for(var b=x$.m(this.users()),a=b.next();!a.done;a=b.next())a.value.trigger("dispose");this.channel&&this.channel.quit&&this.channel.quit(this.id,this);this.myself()&&this.myself().trigger("dispose")}};b[c$pr].onDestroy=function(){for(var b in this)f.default.disposeKoItem(this[b]),this[b]=null};b.getName=function(){};b[c$pr].start=function(){this._started||(this._started=!0,this.chat.connectP2P(this.constructor.getName()))};
b[c$pr].broadcastMsg=function(b,a){this.channel.broadcast(this.id,b,a);this.start()};n.default=b},46:function(b,n,h){var l,f;!(l=[h(1),h(47),h(319),h(320),h(86),h(19),h(13),h(85),h(7)],f=function(b,f,h,l,g,a){function d(a,c){for(;(a=a[c])&&1!==a.nodeType;);return a}var c=/^(?:parents|prev(?:Until|All))/,e={children:!0,contents:!0,next:!0,prev:!0};b.fn.extend({has:function(a){var c=b(a,this),d=c.length;return this.filter(function(){for(var a=0;a<d;a++)if(b.contains(this,c[a]))return!0})},closest:function(a,
c){var d,e=0,k=this.length,p=[],f="string"!==typeof a&&b(a);if(!g.test(a))for(;e<k;e++)for(d=this[e];d&&d!==c;d=d.parentNode)if(11>d.nodeType&&(f?-1<f.index(d):1===d.nodeType&&b.find.matchesSelector(d,a))){p.push(d);break}return this.pushStack(1<p.length?b.uniqueSort(p):p)},index:function(a){return a?"string"===typeof a?f.call(b(a),this[0]):f.call(this,a.jquery?a[0]:a):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,c){return this.pushStack(b.uniqueSort(b.merge(this.get(),
b(a,c))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}});b.each({parent:function(a){return(a=a.parentNode)&&11!==a.nodeType?a:null},parents:function(a){return h(a,"parentNode")},parentsUntil:function(a,c,b){return h(a,"parentNode",b)},next:function(a){return d(a,"nextSibling")},prev:function(a){return d(a,"previousSibling")},nextAll:function(a){return h(a,"nextSibling")},prevAll:function(a){return h(a,"previousSibling")},nextUntil:function(a,c,b){return h(a,
"nextSibling",b)},prevUntil:function(a,c,b){return h(a,"previousSibling",b)},siblings:function(a){return l((a.parentNode||{}).firstChild,a)},children:function(a){return l(a.firstChild)},contents:function(c){if(a(c,"iframe"))return c.contentDocument;a(c,"template")&&(c=c.content||c);return b.merge([],c.childNodes)}},function(a,d){b.fn[a]=function(m,k){var p=b.map(this,d,m);"Until"!==a.slice(-5)&&(k=m);k&&"string"===typeof k&&(p=b.filter(k,p));1<this.length&&(e[a]||b.uniqueSort(p),c.test(a)&&p.reverse());
return this.pushStack(p)}});return b}.apply(n,l),void 0!==f&&(b.exports=f))},480:function(b,n,h){n.__esModule=!0;h(481);var l=h(2),f=h(53);h(6);h(183);var t=h(436),v=h(4),z=h(442),A=h(9),g=h(10),a=h(12),d=function(a,b,d,p){var c=z.default.call(this,a,b,d,p)||this;c.room=b;c.twilioToken=c.room.app.config.twilioToken||[];c.callback_type=l.default.observable("required");c.status=l.default.observable("standby");c.screen_status=l.default.observable("standby");c.config=l.default.observable({sslVersion:0===
location.href.indexOf("https://")||0<=location.href.indexOf("://localhost"),webrtcCoreSupported:t.default.webrtcSupported,webrtcSupported:t.default.webrtcSupported&&(0===location.href.indexOf("https://")||0<=location.href.indexOf("://localhost"))});c.connections={};c.data={};c.rotation=l.default.observable(0);c._stream=l.default.observable({screen:null,rtc:null,video_mute:!1,audio_mute:!1,screen_mute:!1});c.rtcStreamName=l.default.observable("");c.screenStreamName=l.default.observable("na");c.stream_type=
l.default.observable([]);c.rtcStreamType=l.default.observable("na");c.startedCallPopup=l.default.observable(!1);c.stream=l.default.computed({read:function(){return c._stream()},write:function(a){a=f.default.extend({},c._stream(),a);c.stream_type(c.checkStreamType(a));c.rtcStreamType(0>c.stream_type().indexOf("audio_only")?"video":"audio");c.rtcStreamName(a.screen?"na":d.id+"-"+(0>c.stream_type().indexOf("audio_only")?"video":"audio"));c.screenStreamName(c.stream().screen&&d?d.id+"-screen":"na");c._stream(a)}});
c.video_mute=l.default.observable(null);c.audio_mute=l.default.observable(null);c.screen_mute=l.default.observable(null);c.flipScreen=l.default.observable(!1);c.start_audio_call_time=l.default.observable("");c.pick_audio_call_time=l.default.observable("");c.start_video_call_time=l.default.observable("");c.pick_video_call_time=l.default.observable("");c.video_call_time_difference=l.default.observable("");c.audio_call_time_difference=l.default.observable("");c.sholudWePickCall=l.default.observable(null);
c.sholudWePickCall.subscribe(function(){try{c.sholudWePickCall()?c.room.call_sound?(c.room.call_sound.loop=!0,c.room.call_sound.play()):setTimeout(function(){c.room&&c.room.call_sound&&(c.room.call_sound.loop=!0,c.room.call_sound.play())},1E3):c.room.call_sound?(c.room.call_sound.loop=!1,c.room.call_sound.pause(),c.room.call_sound.currentTime=0,c.room.call_sound.pause()):setTimeout(function(){c.room&&c.room.call_sound&&(c.room.call_sound.loop=!1,c.room.call_sound.pause(),c.room.call_sound.currentTime=
0,c.room.call_sound.pause())},1E3)}catch(w){}});setTimeout(function(){["video_mute","audio_mute","screen_mute"].forEach(function(a){c&&c[a]&&c[a].subscribe(function(){if(c._stream()&&c.room.users){for(var b=x$.m(c.room.users()),d=b.next();!d.done;d=b.next())d.value.msg(a,c[a]());c._stream()[a]=c[a]();c._stream.valueHasMutated()}})})},500);c.video_mute.subscribe(function(){c.stream().rtc&&c.stream().rtc.getVideoTracks&&0<c.stream().rtc.getVideoTracks().length&&(c.video_mute()?c.room.chat.app.googleAnalyticscheck("video_mute",
"click","Video muted"):c.stream().rtc.getVideoTracks()[0].enabled||c.room.chat.app.googleAnalyticscheck("video_unmute","click","Video unmuted"),c.stream().rtc.getVideoTracks()[0].enabled=!c.video_mute())});c.audio_mute.subscribe(function(){c.stream().rtc&&c.stream().rtc.getAudioTracks&&0<c.stream().rtc.getAudioTracks().length&&(c.audio_mute()?c.room.chat.app.googleAnalyticscheck("audio_mute","click","Audio muted"):c.stream().rtc.getAudioTracks()[0].enabled||c.room.chat.app.googleAnalyticscheck("audio_unmute",
"click","Audio unmuted"),c.stream().rtc.getAudioTracks()[0].enabled=!c.audio_mute())});c.screen_mute.subscribe(function(){c.stream().screen&&c.stream().screen.getVideoTracks&&0<c.stream().screen.getVideoTracks().length&&(c.screen_mute()?c.room.chat.app.googleAnalyticscheck("screen_mute","click","Screen  muted"):c.stream().screen.getVideoTracks()[0].enabled||c.room.chat.app.googleAnalyticscheck("screen_unmute","click","Screen unmuted"),c.stream().screen.getVideoTracks()[0].enabled=!c.screen_mute())});
c.stream.subscribe(function(){var a=c.stream_type(),b=!1;c.room&&c.room.myself&&c.room.myself()!==c&&(b=!1);0<=a.indexOf("video")?c.video_mute(null===c.video_mute()?!1:c.video_mute()):c.video_mute(null);0<=a.indexOf("audio")?c.audio_mute(null===c.audio_mute()?b:c.audio_mute()):c.audio_mute(null);0<=a.indexOf("screen")?c.screen_mute(null===c.screen_mute()?!1:c.screen_mute()):c.screen_mute(null)});c.trackEvents();return c};x$.i(d,z.default);d[c$pr].flipScreenMethod=function(){this.flipScreen()?
this.flipScreen(!1):this.flipScreen(!0)};d[c$pr].checkStreamType=function(a){var c=[];a.screen&&c.push("screen");a.rtc&&(c.push("rtc"),0<a.rtc.getVideoTracks().length&&c.push("video"),0<a.rtc.getAudioTracks().length&&c.push("audio"),0<a.rtc.getVideoTracks().length&&0==a.rtc.getAudioTracks().length&&c.push("video_only"),0==a.rtc.getVideoTracks().length&&0<a.rtc.getAudioTracks().length&&c.push("audio_only"),0==a.rtc.getVideoTracks().length&&0==a.rtc.getAudioTracks().length&&c.push("none"));return c};
d[c$pr].rotate=function(a){var c=this;a=void 0===a?!0:a;this.isRotateVideoSupport(!0)&&(this.rotation(a?this.rotation()-90:this.rotation()+90),360!=this.rotation()&&-360!=this.rotation()||this.rotation(0),f.default.each(this.room.users(),function(a,b){b.msg("rotate",c.rotation())}))};d[c$pr].startScreenShare=function(){var c=this;"joined"!=this.screen_status()&&this.room.chat&&this.room.chat.app&&this.room.app.frameMananger(function(b){b.checkOperation("webrtc",function(b){b||(c.config().notSSL?
a.default.alert(c.room.app.getTransMsg("Screen sharing required https version of website.")):d.RTC.getUserMediaStreams(c.room.chat.id,"screen",function(a,b,d){if(a)return console.error(a);c.stream({screen:b});c.screen_status("joined");var e={};c.screenCaller=A.default.observableArrayMonitor(c.room.users,function(a){e[a.id]&&"standby"===e[a.id]||a&&a.client()&&a.client().virtual||c.user.id!=a.user.id&&c.startCallWith(a,!0,!1,function(b){b=x$.m(c.room.users());for(var d=b.next();!d.done;d=
b.next())d=d.value,d.user.id===a.user.id&&d.id!=a.id&&c.stopCallWith(d,!0,!0,!1)})},function(a){a&&a.client()&&a.client().virtual||(e[a.id]=a.screen_status(),c.stopCallWith(a,!0))},function(a){return"joined"==c.screen_status()&&c.screenCaller===a})},!1,null,c.room))})})};d[c$pr].switchVideo=function(){this.__last_type||(this.__last_type=!0,this.updateStreams())};d[c$pr].updateStreams=function(){var a=this;this.currentCaller&&(this.__last_hash=this.room.media_settings.getHash(),d.RTC.getUserMediaStreams(this.room.chat.id,
this.__last_type?"video":"audio",function(c,b,d){c||(c=a.stream().rtc,a.stream()&&a.stream().rtc&&(c=a.stream().rtc),a.stream({rtc:b}),c&&c.dispose())}))};d[c$pr].startRTCCall=function(c,b,k){var e=this;c=void 0===c?!0:c;b=void 0===b?null:b;k=void 0===k?!1:k;this.startedCallPopup(!0);this.__last_hash=this.room.media_settings.getHash();this.__last_type=c;this.room&&this.room.chat&&this.room.chat.app&&(c?(this.room.chat.app.googleAnalyticscheck("start_video_call","click","Video Call"),"visitor"==
this.user.type&&-1<["7c7c5","d3feb","79871"].indexOf(acquireIO.accountId)&&this.room.chat.app.trackAudiEvents({eventAction:"content",eventName:"poa - video chat - start",componentName:"poa_application",label:"",currentURL:document.getElementsByClassName("tagove_cookie")[0].src,targetURL:"",clickID:"",elementName:"icon",value:"",pos:""})):(this.room.chat.app.googleAnalyticscheck("start_voice_call","click","Voice Call"),"visitor"==this.user.type&&-1<["7c7c5","d3feb","79871"].indexOf(acquireIO.accountId)&&
this.room.chat.app.trackAudiEvents({eventAction:"content",eventName:"poa - phone - start",componentName:"poa_application",label:"",currentURL:document.getElementsByClassName("tagove_cookie")[0].src,targetURL:"",clickID:"",elementName:"icon",value:"",pos:""})));if("joined"!=this.status()){if(this.sholudWePickCall())return this.sholudWePickCall().cb(c?"video":"audio");var m=[];f.default.each(this.room.users(),function(a,c){"standby"!=c.status()&&m.push(c)});if(5<=m.length)return a.default.alert(this.room.chat.app.getTransMsg("Sorry you can't join this, there are already 5 people in the room, so you can just see the them but you can't share your webcam/voice."));
null==b&&(b=this.callback_type());this._rtc_calling||(this._rtc_calling=!0,this.room.chat.app.frameMananger(function(a){a.checkOperation("webrtc",function(a){var b=function(){var a={};e.currentCaller=A.default.observableArrayMonitor(e.room.users,function(b){"visitor"==b.user.type&&(b&&b.user&&b.user.ua()&&b.user.ua().ua&&-1!==b.user.ua().device.vendor.indexOf("Elo")?e.flipScreen(!0):e.flipScreen(!1));if(!(b&&b.client()&&b.client().virtual||a[b.id]&&"standby"===a[b.id]||e.user.id==b.user.id)){for(var d=
!0===e._one_way_called,q=x$.m(e.room.users()),m=q.next();!m.done;m=q.next())if(m=m.value,!d&&m.user.id===b.user.id&&"joined"==m.status()){console.error("no need to call same user of another client.");return}e._one_way_called=!1;c$und==typeof e.data.type&&(e.data.type=c?"video":"audio",e.data.initiator=e.user.type);e.data&&e.data.type&&("video"==e.data.type?e.start_video_call_time=v.default.toMysqlTime(new Date):e.start_audio_call_time=v.default.toMysqlTime(new Date));e.room.chat.$call("videoEventLogs",
["initiate",e.data]);e.startCallWith(b,!1,k,function(a){a=x$.m(e.room.users());for(var c=a.next();!c.done;c=a.next())c=c.value,c.user.id===b.user.id&&c.id!=b.id&&e.stopCallWith(c,!1,!1,!0)})}},function(c){c&&c.client()&&c.client().virtual||(a[c.id]=c.status(),e.stopCallWith(c,!1))},function(a){return"joined"==e.status()&&e.currentCaller===a})};e.config().webrtcSupported?d.RTC.getUserMediaStreams(e.room.chat.id,c?"video":"audio",function(a,c,d){if(a)console.error(a),e._rtc_calling=
!1;else{e.stream({rtc:c});try{e.status("joined"),e._rtc_calling=!1}catch(q){console.error(q),e._rtc_calling=!1}b()}}):(console.log("Video/Audio call not supported in your browser. Please contact to administrator for more information."),e._rtc_calling=!1)})}))}};d[c$pr].stopScreenCall=function(a){var c=this;a=void 0===a?!0:a;this.room&&this.room.users()&&f.default.each(this.room.users(),function(b,d){"standby"!==d.screen_status()&&c.stopCallWith(d,!0,a)});this.screen_status("standby");this.screenCaller=
null;a&&this.room.refreshMyScreenStatus();this.stream().screen&&(this.stream().screen.dispose&&this.stream().screen.dispose(),this.stream({screen:null}))};d[c$pr].disconnectConferenceCall=function(a){a=void 0===a?!0:a;this.room.chat.app.cutConferenceCall(this.room.chat.id);this.currentCaller=null;a&&this.room.refreshMyRTCStatus()};d[c$pr].stopRTCCall=function(a){var c=this;a=void 0===a?!0:a;this.sholudWePickCall&&this.sholudWePickCall()&&(a?this.sholudWePickCall().cb("declined"):this.sholudWePickCall().cb("hanged"));
a&&this.room&&this.room.chat&&this.room.chat.app&&this.room.chat.app.popUpMananger(function(a){a.sections.remove("rtcroom")});this.status("standby");this.stream()&&this.stream().rtc&&(this.stream().rtc.dispose(),this.stream({rtc:null}),this.room.chat.app.googleAnalyticscheck("call_end","click","Call end"),this.data={},"agent"==this.user.type&&this.room.chat.$call("videoEventLogs",["end",this.data]),this.__last_type&&"visitor"==this.user.type&&-1<["7c7c5","d3feb","79871"].indexOf(acquireIO.accountId)&&
this.room.chat.app.trackAudiEvents({eventAction:"content",eventName:"poa - video chat - close",componentName:"poa_application",label:"",currentURL:document.getElementsByClassName("tagove_cookie")[0].src,targetURL:"",clickID:"",elementName:"icon",value:"",pos:""}),!this.__last_type&&"visitor"==this.user.type&&-1<["7c7c5","d3feb","79871"].indexOf(acquireIO.accountId)&&this.room.chat.app.trackAudiEvents({eventAction:"content",eventName:"poa - phone - close",componentName:"poa_application",label:"",currentURL:document.getElementsByClassName("tagove_cookie")[0].src,
targetURL:"",clickID:"",elementName:"icon",value:"",pos:""}));f.default.each(this.room.users(),function(b,d){"standby"!==d.status()&&c.stopCallWith(d,!1,a)});this.currentCaller=null;a&&this.room.refreshMyRTCStatus()};d[c$pr].watchStreamClosed=function(a,b){var c=this,d="ended";"oninactive"in a&&(d="inactive");a.addEventListener(d,function(){c$fun==typeof c.stream&&c.stream()&&c.stream().rtc||b();b=function(){}},!1);a.getAudioTracks().forEach(function(a){a.addEventListener(d,function(){c$fun==
typeof c.stream&&c.stream()&&c.stream().rtc&&(b(),b=function(){})},!1)});a.getVideoTracks().forEach(function(a){a.addEventListener(d,function(){c$fun==typeof c.stream&&c.stream()&&c.stream().rtc&&(b(),b=function(){})},!1)})};d[c$pr].log=function(a,b){b=void 0===b?!1:b;a=a&&0<=a.indexOf("[call]")?"==>>"+a:"<<=="+a;0<=window.location.href.indexOf("vcxlogs")&&(b?console.error(a):console.log(a))};d[c$pr].startCallWith=function(c,b,k,g){var e=this;b=void 0===b?!1:b;k=void 0===k?!1:k;g=void 0===
g?null:g;b&&"standby"==c.screen_status()&&c.screen_status("incall");b||"standby"!=c.status()||c.status("incall");var f=function(m){m=void 0===m?null:m;if(b||e.config().webrtcSupported&&c.config().webrtcSupported){var k="["+(b?"screenCall":"call")+"]["+c.id+"][R-1]",q=function(){var q=Math.ceil(1E10*Math.random());c.getConnection(b?"screenOut":"out",function(y,f){f();f=y._stream=b?e.stream().screen:e.stream().rtc;if(null==f)return c.status("standby");if(f.getTracks)for(var r=x$.m(f.getTracks()),
p=r.next();!p.done;p=r.next())y.addTrack(p.value,f);else y.addStream(f);e.watchStreamClosed(f,function(){c.id&&e.stopCallWith(c,b,!0)});y.resetCandidateQueue();y.createOffer(function(f){e.log(k+" offer created.",!0);f=d.RTC.lineSettings(f);y.setLocalDescription(new RTCSessionDescription(f),function(){e.log(k+" offer sent.",!0);c.msg(b?"screen":"offer",{call:f,callType:b?"screen":0<e.stream_type().indexOf("video")?"video":"audio",autoPick:m,excluded_recording:e.room&&e.room.excluded_recording?e.room.excluded_recording:
!1},q,function(d){e.log(k+" answer recevied..",!0);if("permissions"==d)a.default.alert(acquireIO.getTransMsg("Camera/Audio permissions were not given.")),c$und==typeof e.data.status&&(e.data.status="permissions"),e.room.chat.$call("videoEventLogs",["unhandled",e.data]),e.onMsg(c,"hangup",!1),e.stopCallWith(c,b,!0,!0),c$fun==typeof g&&g(!1);else if("app_background"==d){c$und==typeof e.data.status&&(e.data.status="app_background");e.room.chat.$call("videoEventLogs",["unhandled",e.data]);
for(var q=!0,m=!0,f=x$.m(e.room.rtcUsers()),r=f.next();!r.done;r=f.next())if((r=r.value)&&r.user&&r.user.clients)for(var p in r.user.clients())"web"==r.user.clients()[p].name&&r.user.clients()[p].online&&(q=!1,r===c&&(m=!1));q&&a.default.alert(acquireIO.getTransMsg("Cannot start video/audio call when user is in background state."));m&&(e.onMsg(c,"hangup",!1),e.stopCallWith(c,b,!0,!0),c$fun==typeof g&&g(!1))}else if("declined"==d||"hanged"==d)e.log(k+" answer declined:"+d,!0),
"declined"==d?(a.default.alert(acquireIO.getTransMsg("The user has declined your "+(b?"screen share":0<e.stream_type().indexOf("video")?"video call":"voice call")+" request.")),c$und==typeof e.data.status&&(e.data.status="declined")):c$und==typeof e.data.status&&(e.data.status="hanged"),e.room.chat.$call("videoEventLogs",["unhandled",e.data]),e.onMsg(c,"hangup",!1),e.stopCallWith(c,b,1>=e.room.rtcUsers().length,!1),"declined"==d&&c$fun==typeof g&&g(!1);else if("string"==typeof d)"busy"==
d&&(a.default.alert(acquireIO.getTransMsg("The visitor is busy. Please try again later")),c$und==typeof e.data.status&&(e.data.status="busy"),e.room.chat.$call("videoEventLogs",["unhandled",e.data])),console.error(d),e.stopCallWith(c,b,!0,!0),c$fun==typeof g&&g(!1);else try{y.setRemoteDescription(new RTCSessionDescription(d),function(){c$fun==typeof g&&g(!0);if("agent"==c.user.type){c$und==typeof e.data.status&&(e.data.status="answered");if(e.data&&e.data.status&&"answered"==
e.data.status)if("video"==e.data.type){if("visitor"==e.user.type&&-1<["7c7c5","d3feb","79871"].indexOf(acquireIO.accountId)){e.pick_video_call_time=v.default.toMysqlTime(new Date);e.video_call_time_difference(e.room.app.timeDifferencesObserverTimer(e.start_video_call_time,e.pick_video_call_time));var a=e.video_call_time_difference().split(":");a=60*+a[0]+ +a[1];e.room.chat.app.trackAudiEvents({eventAction:"non_interaction",eventName:"poa - video chat - operator assigned",componentName:"poa_application",
label:"",currentURL:document.getElementsByClassName("tagove_cookie")[0].src,targetURL:"",clickID:"",elementName:"",value:a?a:"",pos:""})}}else"visitor"==e.user.type&&-1<["7c7c5","d3feb","79871"].indexOf(acquireIO.accountId)&&(e.pick_audio_call_time=v.default.toMysqlTime(new Date),e.audio_call_time_difference(e.room.app.timeDifferencesObserverTimer(e.start_audio_call_time,e.pick_audio_call_time)),a=e.audio_call_time_difference().split(":"),a=60*+a[0]+ +a[1],e.room.chat.app.trackAudiEvents({eventAction:"non_interaction",
eventName:"poa - phone - operator assigned",componentName:"poa_application",label:"",currentURL:document.getElementsByClassName("tagove_cookie")[0].src,targetURL:"",clickID:"",elementName:"",value:a?a:"",pos:""}));e.room.chat.$call("videoEventLogs",["start",e.data])}},function(a){console.log(k+" answer can't accepted.");console.error(d);console.error(a);c$fun==typeof g&&g(!1)})}catch(J){console.error("answer parse failed"),console.error(d),console.error(J),e.stopCallWith(c,b,!0,!0)}})},function(){console.log(k+
" offer can't set locally.");console.error(arguments)})},function(){console.log(k+" offer can't created.");console.error(arguments)},{offerToReceiveAudio:!b&&0<e.stream_type().indexOf("audio"),offerToReceiveVideo:b||0<e.stream_type().indexOf("video")});d.RTC.handleIceCandidates(y,k,function(a){e.log(k+" candidate sent.");c.msg(b?"candidateScreenIn":"candidateIn",a,q,e.room&&e.room.excluded_recording?e.room.excluded_recording:!1)},function(a,c){c||console.error(a)},function(){})},!0)};q();var y=e.stream().rtc;
if(y)var f=null,r=c.__rdiposer=e.stream.subscribe(function(){c.__rdiposer!==r||"joined"!=c.status()&&"incall"!=c.status()||!e.stream().rtc||y===e.stream().rtc||(y=e.stream().rtc,f&&clearTimeout(f),f=setTimeout(q,800))})}},p=b?this.screenCaller:this.currentCaller,r=c.client().online,h=c.client.subscribe(function(){if("standby"!=(b?c.screen_status():c.status())&&p===(b?e.screenCaller:e.currentCaller)){var a=c.client().online;a!=r&&(a&&a&&f(b?"screen":0<=c.stream_type().indexOf("video")?"video":0<=c.stream_type().indexOf("audio")?
"audio":k),r=a)}else A.default.disposeKoItem(h)});f(k)};d[c$pr].stopCallWith=function(a,b,d,g){b=void 0===b?!1:b;d=void 0===d?!0:d;g=void 0===g?!0:g;b?a.screen_status("standby"):a.status("standby");this.log("["+(b?"screenCall":"call")+"]["+a.id+"][R-1] stopCallWith",!0);a.stream().rtc&&!b&&a.stream().rtc.dispose();a.stream().screen&&b&&a.stream().screen.dispose();g&&a.msg("hangup",b);try{a.getConnection(b?"screenOut":"out",function(a){a&&a.dispose()},!1,!0),a.getConnection(b?"screenIn":"in",function(a){a&&
a.dispose()},!1,!0)}catch(m){}d&&(b?this.room.refreshMyScreenStatus():this.room.refreshMyRTCStatus())};d[c$pr].pickUserRTC=function(a,b,k,g,m){var c=this;g=void 0===g?!1:g;if(this.config().webrtcSupported||g){if(c$und!==typeof this.room.chat.app.threadManager){var e=this.room.chat.app.threadManager().activeRoomInRTC()&&this.room.chat.app.threadManager().activeRoomInRTC().rtcroom().incall()&&null===this.room.chat.app.threadManager().activeRoomInRTC().rtcroom().myself().sholudWePickCall()?
this.room.chat.app.threadManager().activeRoomInRTC():null,f=this.room.chat.app.threadManager().activeRoomInRTC()&&null!==this.room.chat.app.threadManager().activeRoomInRTC().rtcroom().myself().sholudWePickCall()?this.room.chat.app.threadManager().activeRoomInRTC():null;if(e&&this.room.chat!==e){k("busy");return}if(f&&this.room.chat!==f){k("busy");return}}var h=function(){c.status();g&&"standby"==c.screen_status()&&c.screen_status("incall");c.room.chat.app.frameMananger(function(e){e.checkOperation("webrtc",
function(e){var q="["+(g?"screenPick":"pick")+"]["+a.id+"][R-0]";c.log(q+" offer received...",!0);a.getConnection(g?"screenIn":"in",function(e,f){"audio"==b.callType&&(e.filterCandidates="video");e.resetCandidateQueue();d.RTC.handleIceCandidates(e,q,function(b){c.log(q+" candidate sent.");a.msg(g?"candidateScreenOut":"candidateOut",b,m)},function(a){});e.setRemoteDescription(new RTCSessionDescription(b.call),function(){c.log(q+" offer accepted...",!0);f();e.createAnswer(function(b){b=d.RTC.lineSettings(b);
e.setLocalDescription(b,function(){c.log(q+" answer sent...",!0);k({type:"answer",sdp:b.sdp});g?a.screen_status("joined"):a.status("joined")},function(){console.error(arguments)})},function(){console.error(arguments)},{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}})},function(){console.error(arguments)})},!0)})})};"joined"==this.status()?h():this.room.chat.app.frameMananger(function(e){e.checkOperation("webrtc",function(e){e=function(e,q){q=void 0===q?null:q;var y=function(a,b){"declined"==
a?(k("declined"),b(!1)):d.RTC.getUserMediaStreams(c.room.chat.id,a,function(a,c,d){a?(k("permissions"),b(!1)):b(d)})};q?setTimeout(function(){y(!0===q?b.callType:q,e)},0):(c.sholudWePickCall()&&c.sholudWePickCall().queue?c.sholudWePickCall().queue.push(e):c.sholudWePickCall({typeText:b.callType,type:b.callType,from:a.user.getFullName(),cb:function(a){var b=c.sholudWePickCall().queue;c.sholudWePickCall(null);y(a,function(a){for(var c=x$.m(b),d=c.next();!d.done;d=c.next())d=d.value,
d(a)})},queue:[e]}),window.acq_conference_mode&&0>c.room.app.popUpMananger().sections().indexOf("rtcroom")&&c.room.app.popUpMananger().sections.push("rtcroom"))};var q="required";if(g||!b.autoPick&&c$und!=c.room.app.account().settings.oneway_audio_video_support&&"1"==c.room.app.account().settings.oneway_audio_video_support&&"frontend"==acquireIO.type)q="one_way";g&&"joined"==c.screen_status()&&(q="one_way");g||"joined"!=c.status()||(q="one_way");"required"==q?e(function(a){if("video"==a)c.startRTCCall(!0);
else if("audio"==a)c.startRTCCall(!1);else return k(a);h()},b.autoPick):"one_way"==q&&(c._one_way_called=!0,g||"standby"!=c.status()||c.status("incall"),h())})})}else k(acquireIO.getTransMsg("Client browser not supported video/audio call."))};d[c$pr].getConnection=function(a,b,d,h){var c=this;h=void 0===h?!1:h;if(!t.default.webrtcSupported)return null;var e=this.connections[a];if(void 0===d?0:d){e&&e[0]&&(e[0].dispose(),e=null);0<=window.location.href.indexOf("removeStunTurn")&&(t.default.PeerConnectionConfig=
{iceServers:[{urls:["stun:stun.l.google.com:19302"]},{urls:["stun:stun1.l.google.com:19302"]},{urls:["stun:stun2.l.google.com:19302"]}]});var k=g.default.trackTimeEvent("webrtc",a+"-signaling-state-local"),r,p,u,l=g.default.trackTimeEvent("webrtc",a+"-connection-failed"),q,y=new RTCPeerConnection(t.default.PeerConnectionConfig,t.default.PeerConnectionOptions);y.onsignalingstatechange=function(){"stable"==y.signalingState&&(r&&r(),p=g.default.trackTimeEvent("webrtc",a+"-connection-state-checking"));
if("have-local-offer"==y.signalingState||"have-remote-offer"==y.signalingState)k(),"have-remote-offer"==y.signalingState&&(r=g.default.trackTimeEvent("webrtc",a+"-signaling-state-stable"))};y.onicegatheringstatechange=function(c){"complete"==y.iceGatheringState&&q?q():"gathering"==y.iceGatheringState&&(q=g.default.trackTimeEvent("webrtc",a+"-candidate-gathering-state"))};y.oniceconnectionstatechange=function(c){"failed"==y.iceConnectionState&&l&&l();"connected"==y.iceConnectionState&&u&&u();"checking"==
y.iceConnectionState&&p&&(p(),u=g.default.trackTimeEvent("webrtc",a+"-connection-state-connected"))};var E=[],n=y.setRemoteDescription;y.filterCandidates=null;y.resetCandidateQueue=function(){E=[]};y.setRemoteDescription=function(){n.apply(this,arguments);for(var a=x$.m(E),c=a.next();!c.done;c=a.next())c=c.value,c();E={push:function(a){a()}}};y.addCandidate=function(a){null!=a&&E.push(function(){y.filterCandidates&&a.sdpMid&&0<=a.sdpMid.indexOf(y.filterCandidates)||a&&a.candidate&&
y.addIceCandidate(a&&a.candidate?new RTCIceCandidate(a):null).then(function(){},function(c){console.error(" failed to add ICE Candidate: "+c.toString());console.error(a);console.error(c)})})};y.ontrack=function(b){var d=b.streams[0];d.dispose=function(){try{d.getTracks().length&&d.getTracks()[0].stop&&d.getTracks().forEach(function(a){a.stop()})}catch(H){}try{d.stop()}catch(H){}if(d.onended)d.onended()};"out"!=a&&("screenIn"==a||"screenOut"==a?c.stream({screen:d}):c.stream({rtc:d}))};y.dispose=function(){try{delete c.connections[a],
y.close(),y._dispose&&y._dispose.dispose()}catch(D){}};b(y,function(){var b=c.connections[a];b&&b[1]&&0<b[1].length&&f.default.each(b[1],function(a,c){c(y)});c.connections[a]=[y,[]]})}else{e||(e=[null,[]],this.connections[a]=e);if(h&&e&&!e[0])return b(null);e&&e[0]?b(e[0]):e[1]&&e[1].push(b)}};d[c$pr].remove=function(){};d[c$pr].trackEvents=function(){var a=this;this.on("ping",function(a){});var b=function(c){return function(b){a._stream()&&(a._stream()[c]=b,a._stream.valueHasMutated())}};
this.on("video_mute",b("video_mute"));this.on("audio_mute",b("audio_mute"));this.on("screen_mute",b("screen_mute"));this.on("rotate",function(c){a.room.chat.app.tracker.isIOS||a._stream()&&a.rotation(c)});this.on("rtc_full_screen",function(c){a.room.chat.app.tracker.isIOS||a.room.chat.app.popUpMananger(function(a){c?a.sections.push("rtcroom"):a.sections.remove("rtcroom")})});this.on("screen_full_screen",function(c){a.room.chat.app.popUpMananger(function(a){c?a.sections.push("screen"):a.sections.remove("screen")})});
this.on("hangup",function(c){!c&&a.stream()&&a.stream().rtc&&(a.stream().rtc.dispose(),a.stream({rtc:null}));c&&a.stream()&&a.stream().screen&&(a.stream().screen.dispose(),a.stream({screen:null}));a.getConnection(c?"screenIn":"in",function(a){a&&a.dispose()},!1,!0);a.getConnection(c?"screenOut":"out",function(a){a&&a.dispose()},!1,!0);c?(a.screenCaller=null,a.screen_status("standby"),a.room.refreshMyScreenStatus()):(a.currentCaller=null,a.status("standby"),a.room.refreshMyRTCStatus());a.sholudWePickCall(null);
a.room.myself().sholudWePickCall(null)});this.on("my_config",function(c){if(c[1]){var b=a.config();b[c[0]]=c[1];a.config(b);a.config.valueHasMutated()}});this.on("offer",function(c,b,d){!0===c.autoPick&&"backend"==a.room.app.type&&("video"==a.room.app.account().settings.agent_default_call_pick_type||"audio"==a.room.app.account().settings.agent_default_call_pick_type?c.autoPick=a.room.app.account().settings.agent_default_call_pick_type:c.autoPick="auto"==a.room.app.account().settings.agent_default_call_pick_type);
a.room.myself().pickUserRTC(a,c,d,!1,b)});this.on("screen",function(c,b,d){a.room.myself().pickUserRTC(a,c,d,!0,b)});this.on("candidateIn",function(c,b){a.log("[pick]["+a.user.id+"][R-X] candidate received.");a.getConnection("in",function(a){a.addCandidate(c)})});this.on("candidateScreenIn",function(c,b){a.getConnection("screenIn",function(a){a.addCandidate(c)})});this.on("candidateScreenOut",function(c,b){a.getConnection("screenOut",function(a){a.addCandidate(c)})});this.on("candidateOut",function(c,
b){a.getConnection("out",function(b){a.log("[call]["+a.user.id+"][R-X] candidate received.");b.addCandidate(c)})})};n.default=d;d.RTC=t.default},481:function(b,n,h){(function(l){var f=h(5);b.exports=function(){return function g(b,f,h){function a(c,k){if(!f[c]){if(!b[c]){if(d)return d(c,!0);k=Error("Cannot find module '"+c+"'");throw k.code="MODULE_NOT_FOUND",k;}k=f[c]={exports:{}};b[c][0].call(k.exports,function(d){var e=b[c][1][d];return a(e?e:d)},k,k.exports,g,b,f,h)}return f[c].exports}for(var d=
!1,c=0;c<h.length;c++)a(h[c]);return a}({1:[function(b,h,l){function g(a,c,b,d,e){c=p.writeRtpDescription(a.kind,c);c+=p.writeIceParameters(a.iceGatherer.getLocalParameters());c+=p.writeDtlsParameters(a.dtlsTransport.getLocalParameters(),"offer"===b?"actpass":e||"active");c+="a=mid:"+a.mid+"\r\n";c=a.rtpSender&&a.rtpReceiver?c+"a=sendrecv\r\n":a.rtpSender?c+"a=sendonly\r\n":a.rtpReceiver?c+"a=recvonly\r\n":c+"a=inactive\r\n";a.rtpSender&&(b=a.rtpSender._initialTrackId||a.rtpSender.track.id,a.rtpSender._initialTrackId=
b,d="msid:"+(d?d.id:"-")+" "+b+"\r\n",c=c+("a="+d)+("a=ssrc:"+a.sendEncodingParameters[0].ssrc+" "+d),a.sendEncodingParameters[0].rtx&&(c+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" "+d,c+="a=ssrc-group:FID "+a.sendEncodingParameters[0].ssrc+" "+a.sendEncodingParameters[0].rtx.ssrc+"\r\n"));c+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" cname:"+p.localCName+"\r\n";a.rtpSender&&a.sendEncodingParameters[0].rtx&&(c+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" cname:"+p.localCName+"\r\n");
return c}function a(a,c){var b=!1;a=f.parse(f.stringify(a));return a.filter(function(a){if(a&&(a.urls||a.url)){var d=a.urls||a.url;a.url&&!a.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var e="string"===typeof d;e&&(d=[d]);d=d.filter(function(a){return 0!==a.indexOf("turn:")||-1===a.indexOf("transport=udp")||-1!==a.indexOf("turn:[")||b?0===a.indexOf("stun:")&&14393<=c&&-1===a.indexOf("?transport=udp"):b=!0});delete a.url;a.urls=e?d[0]:d;return!!d.length}})}function d(a,
c){var b={codecs:[],headerExtensions:[],fecMechanisms:[]},d=function(a,c){a=parseInt(a,10);for(var b=0;b<c.length;b++)if(c[b].payloadType===a||c[b].preferredPayloadType===a)return c[b]},e=function(a,c,b,e){a=d(a.parameters.apt,b);c=d(c.parameters.apt,e);return a&&c&&a.name.toLowerCase()===c.name.toLowerCase()};a.codecs.forEach(function(d){for(var g=0;g<c.codecs.length;g++){var q=c.codecs[g];if(d.name.toLowerCase()===q.name.toLowerCase()&&d.clockRate===q.clockRate&&("rtx"!==d.name.toLowerCase()||!d.parameters||
!q.parameters.apt||e(d,q,a.codecs,c.codecs))){q=f.parse(f.stringify(q));q.numChannels=Math.min(d.numChannels,q.numChannels);b.codecs.push(q);q.rtcpFeedback=q.rtcpFeedback.filter(function(a){for(var c=0;c<d.rtcpFeedback.length;c++)if(d.rtcpFeedback[c].type===a.type&&d.rtcpFeedback[c].parameter===a.parameter)return!0;return!1});break}}});a.headerExtensions.forEach(function(a){for(var d=0;d<c.headerExtensions.length;d++){var e=c.headerExtensions[d];if(a.uri===e.uri){b.headerExtensions.push(e);break}}});
return b}function c(a,c,b){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[c][a].indexOf(b)}function e(a,c){var b=a.getRemoteCandidates().find(function(a){return c.foundation===a.foundation&&c.ip===a.ip&&c.port===a.port&&c.priority===a.priority&&c.protocol===a.protocol&&c.type===a.type});
b||a.addRemoteCandidate(c);return!b}function k(a,c){c=Error(c);c.name=a;c.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[a];return c}var p=b("sdp");h.exports=function(b,h){function m(a,c){c.addTrack(a);c.dispatchEvent(new b.MediaStreamTrackEvent("addtrack",{track:a}))}function r(a,c){c.removeTrack(a);c.dispatchEvent(new b.MediaStreamTrackEvent("removetrack",{track:a}))}function w(a,c,d,e){var q=new Event("track");q.track=c;q.receiver=d;
q.transceiver={receiver:d};q.streams=e;b.setTimeout(function(){a._dispatchEvent("track",q)})}var u=function(c){var d=this,e=document.createDocumentFragment();["addEventListener","removeEventListener","dispatchEvent"].forEach(function(a){d[a]=e[a].bind(e)});this.canTrickleIceCandidates=null;this.needNegotiation=!1;this.localStreams=[];this.remoteStreams=[];this.remoteDescription=this.localDescription=null;this.signalingState="stable";this.iceGatheringState=this.connectionState=this.iceConnectionState=
"new";c=f.parse(f.stringify(c||{}));this.usingBundle="max-bundle"===c.bundlePolicy;if("negotiate"===c.rtcpMuxPolicy)throw k("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");c.rtcpMuxPolicy||(c.rtcpMuxPolicy="require");switch(c.iceTransportPolicy){case "all":case "relay":break;default:c.iceTransportPolicy="all"}switch(c.bundlePolicy){case "balanced":case "max-compat":case "max-bundle":break;default:c.bundlePolicy="balanced"}c.iceServers=a(c.iceServers||[],h);this._iceGatherers=[];
if(c.iceCandidatePoolSize)for(var q=c.iceCandidatePoolSize;0<q;q--)this._iceGatherers.push(new b.RTCIceGatherer({iceServers:c.iceServers,gatherPolicy:c.iceTransportPolicy}));else c.iceCandidatePoolSize=0;this._config=c;this.transceivers=[];this._sdpSessionId=p.generateSessionId();this._sdpSessionVersion=0;this._dtlsRole=void 0;this._isClosed=!1};u[c$pr].onicecandidate=null;u[c$pr].onaddstream=null;u[c$pr].ontrack=null;u[c$pr].onremovestream=null;u[c$pr].onsignalingstatechange=
null;u[c$pr].oniceconnectionstatechange=null;u[c$pr].onconnectionstatechange=null;u[c$pr].onicegatheringstatechange=null;u[c$pr].onnegotiationneeded=null;u[c$pr].ondatachannel=null;u[c$pr]._dispatchEvent=function(a,c){if(!this._isClosed&&(this.dispatchEvent(c),c$fun===typeof this["on"+a]))this["on"+a](c)};u[c$pr]._emitGatheringStateChange=function(){var a=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",a)};u[c$pr].getConfiguration=
function(){return this._config};u[c$pr].getLocalStreams=function(){return this.localStreams};u[c$pr].getRemoteStreams=function(){return this.remoteStreams};u[c$pr]._createTransceiver=function(a,c){var b=0<this.transceivers.length;a={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:a,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],
wantReceive:!0};this.usingBundle&&b?(a.iceTransport=this.transceivers[0].iceTransport,a.dtlsTransport=this.transceivers[0].dtlsTransport):(b=this._createIceAndDtlsTransports(),a.iceTransport=b.iceTransport,a.dtlsTransport=b.dtlsTransport);c||this.transceivers.push(a);return a};u[c$pr].addTrack=function(a,c){if(this._isClosed)throw k("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");if(this.transceivers.find(function(c){return c.track===a}))throw k("InvalidAccessError",
"Track already exists.");for(var d,e=0;e<this.transceivers.length;e++)this.transceivers[e].track||this.transceivers[e].kind!==a.kind||(d=this.transceivers[e]);d||(d=this._createTransceiver(a.kind));this._maybeFireNegotiationNeeded();-1===this.localStreams.indexOf(c)&&this.localStreams.push(c);d.track=a;d.stream=c;d.rtpSender=new b.RTCRtpSender(a,d.dtlsTransport);return d.rtpSender};u[c$pr].addStream=function(a){var c=this;if(15025<=h)a.getTracks().forEach(function(b){c.addTrack(b,a)});else{var b=
a.clone();a.getTracks().forEach(function(a,c){var d=b.getTracks()[c];a.addEventListener("enabled",function(a){d.enabled=a.enabled})});b.getTracks().forEach(function(a){c.addTrack(a,b)})}};u[c$pr].removeTrack=function(a){if(this._isClosed)throw k("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(a instanceof b.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var c=this.transceivers.find(function(c){return c.rtpSender===
a});if(!c)throw k("InvalidAccessError","Sender was not created by this connection.");var d=c.stream;c.rtpSender.stop();c.rtpSender=null;c.track=null;c.stream=null;-1===this.transceivers.map(function(a){return a.stream}).indexOf(d)&&-1<this.localStreams.indexOf(d)&&this.localStreams.splice(this.localStreams.indexOf(d),1);this._maybeFireNegotiationNeeded()};u[c$pr].removeStream=function(a){var c=this;a.getTracks().forEach(function(a){var b=c.getSenders().find(function(c){return c.track===a});b&&
c.removeTrack(b)})};u[c$pr].getSenders=function(){return this.transceivers.filter(function(a){return!!a.rtpSender}).map(function(a){return a.rtpSender})};u[c$pr].getReceivers=function(){return this.transceivers.filter(function(a){return!!a.rtpReceiver}).map(function(a){return a.rtpReceiver})};u[c$pr]._createIceGatherer=function(a,c){var d=this;if(c&&0<a)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var e=new b.RTCIceGatherer({iceServers:this._config.iceServers,
gatherPolicy:this._config.iceTransportPolicy});Object.defineProperty(e,"state",{value:"new",writable:!0});this.transceivers[a].bufferedCandidateEvents=[];this.transceivers[a].bufferCandidates=function(c){var b=!c.candidate||0===Object.keys(c.candidate).length;e.state=b?"completed":"gathering";null!==d.transceivers[a].bufferedCandidateEvents&&d.transceivers[a].bufferedCandidateEvents.push(c)};e.addEventListener("localcandidate",this.transceivers[a].bufferCandidates);return e};u[c$pr]._gather=function(a,
c){var d=this,e=this.transceivers[c].iceGatherer;if(!e.onlocalcandidate){var q=this.transceivers[c].bufferedCandidateEvents;this.transceivers[c].bufferedCandidateEvents=null;e.removeEventListener("localcandidate",this.transceivers[c].bufferCandidates);e.onlocalcandidate=function(b){if(!(d.usingBundle&&0<c)){var q=new Event("icecandidate");q.candidate={sdpMid:a,sdpMLineIndex:c};var g=b.candidate;if(b=!g||0===Object.keys(g).length){if("new"===e.state||"gathering"===e.state)e.state="completed"}else"new"===
e.state&&(e.state="gathering"),g.component=1,g.ufrag=e.getLocalParameters().usernameFragment,g=p.writeCandidate(g),q.candidate=Object.assign(q.candidate,p.parseCandidate(g)),q.candidate.candidate=g,q.candidate.toJSON=function(){return{candidate:q.candidate.candidate,sdpMid:q.candidate.sdpMid,sdpMLineIndex:q.candidate.sdpMLineIndex,usernameFragment:q.candidate.usernameFragment}};g=p.getMediaSections(d.localDescription.sdp);g[q.candidate.sdpMLineIndex]=b?g[q.candidate.sdpMLineIndex]+"a=end-of-candidates\r\n":
g[q.candidate.sdpMLineIndex]+("a="+q.candidate.candidate+"\r\n");d.localDescription.sdp=p.getDescription(d.localDescription.sdp)+g.join("");g=d.transceivers.every(function(a){return a.iceGatherer&&"completed"===a.iceGatherer.state});"gathering"!==d.iceGatheringState&&(d.iceGatheringState="gathering",d._emitGatheringStateChange());b||d._dispatchEvent("icecandidate",q);g&&(d._dispatchEvent("icecandidate",new Event("icecandidate")),d.iceGatheringState="complete",d._emitGatheringStateChange())}};b.setTimeout(function(){q.forEach(function(a){e.onlocalcandidate(a)})},
0)}};u[c$pr]._createIceAndDtlsTransports=function(){var a=this,c=new b.RTCIceTransport(null);c.onicestatechange=function(){a._updateIceConnectionState();a._updateConnectionState()};var d=new b.RTCDtlsTransport(c);d.ondtlsstatechange=function(){a._updateConnectionState()};d.onerror=function(){Object.defineProperty(d,"state",{value:"failed",writable:!0});a._updateConnectionState()};return{iceTransport:c,dtlsTransport:d}};u[c$pr]._disposeIceAndDtlsTransports=function(a){var c=this.transceivers[a].iceGatherer;
c&&(delete c.onlocalcandidate,delete this.transceivers[a].iceGatherer);if(c=this.transceivers[a].iceTransport)delete c.onicestatechange,delete this.transceivers[a].iceTransport;if(c=this.transceivers[a].dtlsTransport)delete c.ondtlsstatechange,delete c.onerror,delete this.transceivers[a].dtlsTransport};u[c$pr]._transceive=function(a,c,b){var e=d(a.localCapabilities,a.remoteCapabilities);c&&a.rtpSender&&(e.encodings=a.sendEncodingParameters,e.rtcp={cname:p.localCName,compound:a.rtcpParameters.compound},
a.recvEncodingParameters.length&&(e.rtcp.ssrc=a.recvEncodingParameters[0].ssrc),a.rtpSender.send(e));b&&a.rtpReceiver&&0<e.codecs.length&&("video"===a.kind&&a.recvEncodingParameters&&15019>h&&a.recvEncodingParameters.forEach(function(a){delete a.rtx}),e.encodings=a.recvEncodingParameters.length?a.recvEncodingParameters:[{}],e.rtcp={compound:a.rtcpParameters.compound},a.rtcpParameters.cname&&(e.rtcp.cname=a.rtcpParameters.cname),a.sendEncodingParameters.length&&(e.rtcp.ssrc=a.sendEncodingParameters[0].ssrc),
a.rtpReceiver.receive(e))};u[c$pr].setLocalDescription=function(a){var b=this;if(-1===["offer","answer"].indexOf(a.type))return Promise.reject(k("TypeError",'Unsupported type "'+a.type+'"'));if(!c("setLocalDescription",a.type,b.signalingState)||b._isClosed)return Promise.reject(k("InvalidStateError","Can not set local "+a.type+" in state "+b.signalingState));if("offer"===a.type){var e=p.splitSections(a.sdp);var g=e.shift();e.forEach(function(a,c){a=p.parseRtpParameters(a);b.transceivers[c].localCapabilities=
a});b.transceivers.forEach(function(a,c){b._gather(a.mid,c)})}else if("answer"===a.type){e=p.splitSections(b.remoteDescription.sdp);g=e.shift();var q=0<p.matchPrefix(g,"a=ice-lite").length;e.forEach(function(a,c){var e=b.transceivers[c],f=e.iceGatherer,k=e.iceTransport,h=e.dtlsTransport,r=e.localCapabilities,y=e.remoteCapabilities;if(!(p.isRejected(a)&&0===p.matchPrefix(a,"a=bundle-only").length||e.rejected)){var m=p.getIceParameters(a,g);a=p.getDtlsParameters(a,g);q&&(a.role="server");b.usingBundle&&
0!==c||(b._gather(e.mid,c),"new"===k.state&&k.start(f,m,q?"controlling":"controlled"),"new"===h.state&&h.start(a));c=d(r,y);b._transceive(e,0<c.codecs.length,!1)}})}b.localDescription={type:a.type,sdp:a.sdp};"offer"===a.type?b._updateSignalingState("have-local-offer"):b._updateSignalingState("stable");return Promise.resolve()};u[c$pr].setRemoteDescription=function(a){var d=this;if(-1===["offer","answer"].indexOf(a.type))return Promise.reject(k("TypeError",'Unsupported type "'+a.type+'"'));if(!c("setRemoteDescription",
a.type,d.signalingState)||d._isClosed)return Promise.reject(k("InvalidStateError","Can not set remote "+a.type+" in state "+d.signalingState));var g={};d.remoteStreams.forEach(function(a){g[a.id]=a});var q=[],f=p.splitSections(a.sdp),x=f.shift(),u=0<p.matchPrefix(x,"a=ice-lite").length,l=0<p.matchPrefix(x,"a=group:BUNDLE ").length;d.usingBundle=l;var B=p.matchPrefix(x,"a=ice-options:")[0];d.canTrickleIceCandidates=B?0<=B.substr(14).split(" ").indexOf("trickle"):!1;f.forEach(function(c,f){var k=p.splitLines(c),
y=p.getKind(c),w=p.isRejected(c)&&0===p.matchPrefix(c,"a=bundle-only").length,B=k[0].substr(2).split(" ")[2];k=p.getDirection(c,x);var n=p.parseMsid(c),C=p.getMid(c)||p.generateIdentifier();if("application"===y&&"DTLS/SCTP"===B||w)d.transceivers[f]={mid:C,kind:y,rejected:!0};else{!w&&d.transceivers[f]&&d.transceivers[f].rejected&&(d.transceivers[f]=d._createTransceiver(y,!0));var v=p.parseRtpParameters(c);if(!w){var E=p.getIceParameters(c,x);var D=p.getDtlsParameters(c,x);D.role="client"}B=p.parseRtpEncodingParameters(c);
var I=p.parseRtcpParameters(c),F=0<p.matchPrefix(c,"a=end-of-candidates",x).length,A=p.matchPrefix(c,"a=candidate:").map(function(a){return p.parseCandidate(a)}).filter(function(a){return 1===a.component});("offer"===a.type||"answer"===a.type)&&!w&&l&&0<f&&d.transceivers[f]&&(d._disposeIceAndDtlsTransports(f),d.transceivers[f].iceGatherer=d.transceivers[0].iceGatherer,d.transceivers[f].iceTransport=d.transceivers[0].iceTransport,d.transceivers[f].dtlsTransport=d.transceivers[0].dtlsTransport,d.transceivers[f].rtpSender&&
d.transceivers[f].rtpSender.setTransport(d.transceivers[0].dtlsTransport),d.transceivers[f].rtpReceiver&&d.transceivers[f].rtpReceiver.setTransport(d.transceivers[0].dtlsTransport));if("offer"!==a.type||w)"answer"!==a.type||w||(z=d.transceivers[f],G=z.iceGatherer,y=z.iceTransport,C=z.dtlsTransport,H=z.rtpReceiver,w=z.sendEncodingParameters,c=z.localCapabilities,d.transceivers[f].recvEncodingParameters=B,d.transceivers[f].remoteCapabilities=v,d.transceivers[f].rtcpParameters=I,A.length&&"new"===y.state&&
(!u&&!F||l&&0!==f?A.forEach(function(a){e(z.iceTransport,a)}):y.setRemoteCandidates(A)),l&&0!==f||("new"===y.state&&y.start(G,E,"controlling"),"new"===C.state&&C.start(D)),d._transceive(z,"sendrecv"===k||"recvonly"===k,"sendrecv"===k||"sendonly"===k),!H||"sendrecv"!==k&&"sendonly"!==k?delete z.rtpReceiver:(k=H.track,n?(g[n.stream]||(g[n.stream]=new b.MediaStream),m(k,g[n.stream]),q.push([k,H,g[n.stream]])):(g.default||(g.default=new b.MediaStream),m(k,g.default),q.push([k,H,g.default]))));else{var z=
d.transceivers[f]||d._createTransceiver(y);z.mid=C;z.iceGatherer||(z.iceGatherer=d._createIceGatherer(f,l));A.length&&"new"===z.iceTransport.state&&(!F||l&&0!==f?A.forEach(function(a){e(z.iceTransport,a)}):z.iceTransport.setRemoteCandidates(A));c=b.RTCRtpReceiver.getCapabilities(y);15019>h&&(c.codecs=c.codecs.filter(function(a){return"rtx"!==a.name}));w=z.sendEncodingParameters||[{ssrc:1001*(2*f+2)}];E=!1;if("sendrecv"===k||"sendonly"===k){E=!z.rtpReceiver;var H=z.rtpReceiver||new b.RTCRtpReceiver(z.dtlsTransport,
y);if(E){k=H.track;if(!n||"-"!==n.stream)if(n){g[n.stream]||(g[n.stream]=new b.MediaStream,Object.defineProperty(g[n.stream],"id",{get:function(){return n.stream}}));Object.defineProperty(k,"id",{get:function(){return n.track}});var G=g[n.stream]}else g.default||(g.default=new b.MediaStream),G=g.default;G&&(m(k,G),z.associatedRemoteMediaStreams.push(G));q.push([k,H,G])}}else z.rtpReceiver&&z.rtpReceiver.track&&(z.associatedRemoteMediaStreams.forEach(function(a){var c=a.getTracks().find(function(a){return a.id===
z.rtpReceiver.track.id});c&&r(c,a)}),z.associatedRemoteMediaStreams=[]);z.localCapabilities=c;z.remoteCapabilities=v;z.rtpReceiver=H;z.rtcpParameters=I;z.sendEncodingParameters=w;z.recvEncodingParameters=B;d._transceive(d.transceivers[f],!1,E)}}});void 0===d._dtlsRole&&(d._dtlsRole="offer"===a.type?"active":"passive");d.remoteDescription={type:a.type,sdp:a.sdp};"offer"===a.type?d._updateSignalingState("have-remote-offer"):d._updateSignalingState("stable");Object.keys(g).forEach(function(a){var c=
g[a];if(c.getTracks().length){if(-1===d.remoteStreams.indexOf(c)){d.remoteStreams.push(c);var e=new Event("addstream");e.stream=c;b.setTimeout(function(){d._dispatchEvent("addstream",e)})}q.forEach(function(a){c.id===a[2].id&&w(d,a[0],a[1],[c])})}});q.forEach(function(a){a[2]||w(d,a[0],a[1],[])});b.setTimeout(function(){d&&d.transceivers&&d.transceivers.forEach(function(a){a.iceTransport&&"new"===a.iceTransport.state&&0<a.iceTransport.getRemoteCandidates().length&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),
a.iceTransport.addRemoteCandidate({}))})},4E3);return Promise.resolve()};u[c$pr].close=function(){this.transceivers.forEach(function(a){a.iceTransport&&a.iceTransport.stop();a.dtlsTransport&&a.dtlsTransport.stop();a.rtpSender&&a.rtpSender.stop();a.rtpReceiver&&a.rtpReceiver.stop()});this._isClosed=!0;this._updateSignalingState("closed")};u[c$pr]._updateSignalingState=function(a){this.signalingState=a;a=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",a)};u[c$pr]._maybeFireNegotiationNeeded=
function(){var a=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,b.setTimeout(function(){if(a.needNegotiation){a.needNegotiation=!1;var c=new Event("negotiationneeded");a._dispatchEvent("negotiationneeded",c)}},0))};u[c$pr]._updateIceConnectionState=function(){var a={"new":0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach(function(c){a[c.iceTransport.state]++});var c="new";0<a.failed?c="failed":0<a.checking?
c="checking":0<a.disconnected?c="disconnected":0<a.new?c="new":0<a.connected?c="connected":0<a.completed&&(c="completed");c!==this.iceConnectionState&&(this.iceConnectionState=c,c=new Event("iceconnectionstatechange"),this._dispatchEvent("iceconnectionstatechange",c))};u[c$pr]._updateConnectionState=function(){var a={"new":0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach(function(c){a[c.iceTransport.state]++;a[c.dtlsTransport.state]++});a.connected+=
a.completed;var c="new";0<a.failed?c="failed":0<a.connecting?c="connecting":0<a.disconnected?c="disconnected":0<a.new?c="new":0<a.connected&&(c="connected");c!==this.connectionState&&(this.connectionState=c,c=new Event("connectionstatechange"),this._dispatchEvent("connectionstatechange",c))};u[c$pr].createOffer=function(a){var c=this;if(c._isClosed)return Promise.reject(k("InvalidStateError","Can not call createOffer after close"));var d=c.transceivers.filter(function(a){return"audio"===a.kind}).length,
e=c.transceivers.filter(function(a){return"video"===a.kind}).length;if(a){if(a.mandatory||a.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==a.offerToReceiveAudio&&(d=!0===a.offerToReceiveAudio?1:!1===a.offerToReceiveAudio?0:a.offerToReceiveAudio);void 0!==a.offerToReceiveVideo&&(e=!0===a.offerToReceiveVideo?1:!1===a.offerToReceiveVideo?0:a.offerToReceiveVideo)}for(c.transceivers.forEach(function(a){"audio"===a.kind?(d--,0>d&&(a.wantReceive=!1)):"video"===
a.kind&&(e--,0>e&&(a.wantReceive=!1))});0<d||0<e;)0<d&&(c._createTransceiver("audio"),d--),0<e&&(c._createTransceiver("video"),e--);var f=p.writeSessionBoilerplate(c._sdpSessionId,c._sdpSessionVersion++);c.transceivers.forEach(function(a,d){var e=a.track,g=a.kind,f=a.mid||p.generateIdentifier();a.mid=f;a.iceGatherer||(a.iceGatherer=c._createIceGatherer(d,c.usingBundle));f=b.RTCRtpSender.getCapabilities(g);15019>h&&(f.codecs=f.codecs.filter(function(a){return"rtx"!==a.name}));f.codecs.forEach(function(c){"H264"===
c.name&&void 0===c.parameters["level-asymmetry-allowed"]&&(c.parameters["level-asymmetry-allowed"]="1");a.remoteCapabilities&&a.remoteCapabilities.codecs&&a.remoteCapabilities.codecs.forEach(function(a){c.name.toLowerCase()===a.name.toLowerCase()&&c.clockRate===a.clockRate&&(c.preferredPayloadType=a.payloadType)})});f.headerExtensions.forEach(function(c){(a.remoteCapabilities&&a.remoteCapabilities.headerExtensions||[]).forEach(function(a){c.uri===a.uri&&(c.id=a.id)})});d=a.sendEncodingParameters||
[{ssrc:1001*(2*d+1)}];e&&15019<=h&&"video"===g&&!d[0].rtx&&(d[0].rtx={ssrc:d[0].ssrc+1});a.wantReceive&&(a.rtpReceiver=new b.RTCRtpReceiver(a.dtlsTransport,g));a.localCapabilities=f;a.sendEncodingParameters=d});"max-compat"!==c._config.bundlePolicy&&(f+="a=group:BUNDLE "+c.transceivers.map(function(a){return a.mid}).join(" ")+"\r\n");f+="a=ice-options:trickle\r\n";c.transceivers.forEach(function(a,b){f+=g(a,a.localCapabilities,"offer",a.stream,c._dtlsRole);f+="a=rtcp-rsize\r\n";!a.iceGatherer||"new"===
c.iceGatheringState||0!==b&&c.usingBundle||(a.iceGatherer.getLocalCandidates().forEach(function(a){a.component=1;f+="a="+p.writeCandidate(a)+"\r\n"}),"completed"===a.iceGatherer.state&&(f+="a=end-of-candidates\r\n"))});a=new b.RTCSessionDescription({type:"offer",sdp:f});return Promise.resolve(a)};u[c$pr].createAnswer=function(){var a=this;if(a._isClosed)return Promise.reject(k("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==a.signalingState&&"have-local-pranswer"!==
a.signalingState)return Promise.reject(k("InvalidStateError","Can not call createAnswer in signalingState "+a.signalingState));var c=p.writeSessionBoilerplate(a._sdpSessionId,a._sdpSessionVersion++);a.usingBundle&&(c+="a=group:BUNDLE "+a.transceivers.map(function(a){return a.mid}).join(" ")+"\r\n");var e=p.getMediaSections(a.remoteDescription.sdp).length;a.transceivers.forEach(function(b,f){if(!(f+1>e))if(b.rejected)"application"===b.kind?c+="m=application 0 DTLS/SCTP 5000\r\n":"audio"===b.kind?c+=
"m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===b.kind&&(c+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),c+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+b.mid+"\r\n";else{if(b.stream){var k;"audio"===b.kind?k=b.stream.getAudioTracks()[0]:"video"===b.kind&&(k=b.stream.getVideoTracks()[0]);k&&15019<=h&&"video"===b.kind&&!b.sendEncodingParameters[0].rtx&&(b.sendEncodingParameters[0].rtx={ssrc:b.sendEncodingParameters[0].ssrc+1})}f=d(b.localCapabilities,b.remoteCapabilities);
!f.codecs.filter(function(a){return"rtx"===a.name.toLowerCase()}).length&&b.sendEncodingParameters[0].rtx&&delete b.sendEncodingParameters[0].rtx;c+=g(b,f,"answer",b.stream,a._dtlsRole);b.rtcpParameters&&b.rtcpParameters.reducedSize&&(c+="a=rtcp-rsize\r\n")}});var f=new b.RTCSessionDescription({type:"answer",sdp:c});return Promise.resolve(f)};u[c$pr].addIceCandidate=function(a){var c=this,b;return a&&void 0===a.sdpMLineIndex&&!a.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):
new Promise(function(d,g){if(c.remoteDescription)if(a&&""!==a.candidate){var f=a.sdpMLineIndex;if(a.sdpMid)for(var h=0;h<c.transceivers.length;h++)if(c.transceivers[h].mid===a.sdpMid){f=h;break}var r=c.transceivers[f];if(r){if(r.rejected)return d();h=0<Object.keys(a.candidate).length?p.parseCandidate(a.candidate):{};if("tcp"===h.protocol&&(0===h.port||9===h.port)||h.component&&1!==h.component)return d();if((0===f||0<f&&r.iceTransport!==c.transceivers[0].iceTransport)&&!e(r.iceTransport,h))return g(k("OperationError",
"Can not add ICE candidate"));g=a.candidate.trim();0===g.indexOf("a=")&&(g=g.substr(2));b=p.getMediaSections(c.remoteDescription.sdp);b[f]+="a="+(h.type?g:"end-of-candidates")+"\r\n";c.remoteDescription.sdp=p.getDescription(c.remoteDescription.sdp)+b.join("")}else return g(k("OperationError","Can not add ICE candidate"))}else for(f=0;f<c.transceivers.length&&(c.transceivers[f].rejected||(c.transceivers[f].iceTransport.addRemoteCandidate({}),b=p.getMediaSections(c.remoteDescription.sdp),b[f]+="a=end-of-candidates\r\n",
c.remoteDescription.sdp=p.getDescription(c.remoteDescription.sdp)+b.join(""),!c.usingBundle));f++);else return g(k("InvalidStateError","Can not add ICE candidate without a remote description"));d()})};u[c$pr].getStats=function(a){if(a&&a instanceof b.MediaStreamTrack){var c=null;this.transceivers.forEach(function(b){b.rtpSender&&b.rtpSender.track===a?c=b.rtpSender:b.rtpReceiver&&b.rtpReceiver.track===a&&(c=b.rtpReceiver)});if(!c)throw k("InvalidAccessError","Invalid selector.");return c.getStats()}var d=
[];this.transceivers.forEach(function(a){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(c){a[c]&&d.push(a[c].getStats())})});return Promise.all(d).then(function(a){var c=new Map;a.forEach(function(a){a.forEach(function(a){c.set(a.id,a)})});return c})};["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(a){if((a=b[a])&&a[c$pr]&&a[c$pr].getStats){var c=a[c$pr].getStats;a[c$pr].getStats=function(){return c.apply(this).then(function(a){var c=
new Map;Object.keys(a).forEach(function(b){var d=a[b];a[b].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[d.type]||d.type;c.set(b,a[b])});return c})}}});var l=["createOffer","createAnswer"];l.forEach(function(a){var c=u[c$pr][a];u[c$pr][a]=function(){var a=arguments;return c$fun===typeof a[0]||c$fun===typeof a[1]?c.apply(this,[arguments[2]]).then(function(c){c$fun===
typeof a[0]&&a[0].apply(null,[c])},function(c){c$fun===typeof a[1]&&a[1].apply(null,[c])}):c.apply(this,arguments)}});l=["setLocalDescription","setRemoteDescription","addIceCandidate"];l.forEach(function(a){var c=u[c$pr][a];u[c$pr][a]=function(){var a=arguments;return c$fun===typeof a[1]||c$fun===typeof a[2]?c.apply(this,arguments).then(function(){c$fun===typeof a[1]&&a[1].apply(null)},function(c){c$fun===typeof a[2]&&a[2].apply(null,[c])}):c.apply(this,arguments)}});
["getStats"].forEach(function(a){var c=u[c$pr][a];u[c$pr][a]=function(){var a=arguments;return c$fun===typeof a[1]?c.apply(this,arguments).then(function(){c$fun===typeof a[1]&&a[1].apply(null)}):c.apply(this,arguments)}});return u}},{sdp:2}],2:[function(b,h,l){var g={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};g.localCName=g.generateIdentifier();g.splitLines=function(a){return a.trim().split("\n").map(function(a){return a.trim()})};g.splitSections=
function(a){return a.split("\nm=").map(function(a,c){return(0<c?"m="+a:a).trim()+"\r\n"})};g.getDescription=function(a){return(a=g.splitSections(a))&&a[0]};g.getMediaSections=function(a){a=g.splitSections(a);a.shift();return a};g.matchPrefix=function(a,b){return g.splitLines(a).filter(function(a){return 0===a.indexOf(b)})};g.parseCandidate=function(a){a=0===a.indexOf("a=candidate:")?a.substring(12).split(" "):a.substring(10).split(" ");for(var b={foundation:a[0],component:parseInt(a[1],10),protocol:a[2].toLowerCase(),
priority:parseInt(a[3],10),ip:a[4],port:parseInt(a[5],10),type:a[7]},c=8;c<a.length;c+=2)switch(a[c]){case "raddr":b.relatedAddress=a[c+1];break;case "rport":b.relatedPort=parseInt(a[c+1],10);break;case "tcptype":b.tcpType=a[c+1];break;case "ufrag":b.ufrag=a[c+1];b.usernameFragment=a[c+1];break;default:b[a[c]]=a[c+1]}return b};g.writeCandidate=function(a){var b=[];b.push(a.foundation);b.push(a.component);b.push(a.protocol.toUpperCase());b.push(a.priority);b.push(a.ip);b.push(a.port);var c=a.type;
b.push("typ");b.push(c);"host"!==c&&a.relatedAddress&&a.relatedPort&&(b.push("raddr"),b.push(a.relatedAddress),b.push("rport"),b.push(a.relatedPort));a.tcpType&&"tcp"===a.protocol.toLowerCase()&&(b.push("tcptype"),b.push(a.tcpType));if(a.usernameFragment||a.ufrag)b.push("ufrag"),b.push(a.usernameFragment||a.ufrag);return"candidate:"+b.join(" ")};g.parseIceOptions=function(a){return a.substr(14).split(" ")};g.parseRtpMap=function(a){a=a.substr(9).split(" ");var b={payloadType:parseInt(a.shift(),10)};
a=a[0].split("/");b.name=a[0];b.clockRate=parseInt(a[1],10);b.numChannels=3===a.length?parseInt(a[2],10):1;return b};g.writeRtpMap=function(a){var b=a.payloadType;void 0!==a.preferredPayloadType&&(b=a.preferredPayloadType);return"a=rtpmap:"+b+" "+a.name+"/"+a.clockRate+(1!==a.numChannels?"/"+a.numChannels:"")+"\r\n"};g.parseExtmap=function(a){a=a.substr(9).split(" ");return{id:parseInt(a[0],10),direction:0<a[0].indexOf("/")?a[0].split("/")[1]:"sendrecv",uri:a[1]}};g.writeExtmap=function(a){return"a=extmap:"+
(a.id||a.preferredId)+(a.direction&&"sendrecv"!==a.direction?"/"+a.direction:"")+" "+a.uri+"\r\n"};g.parseFmtp=function(a){for(var b={},c=a.substr(a.indexOf(" ")+1).split(";"),e=0;e<c.length;e++)a=c[e].trim().split("="),b[a[0].trim()]=a[1];return b};g.writeFmtp=function(a){var b="",c=a.payloadType;void 0!==a.preferredPayloadType&&(c=a.preferredPayloadType);if(a.parameters&&Object.keys(a.parameters).length){var e=[];Object.keys(a.parameters).forEach(function(c){e.push(c+"="+a.parameters[c])});b+="a=fmtp:"+
c+" "+e.join(";")+"\r\n"}return b};g.parseRtcpFb=function(a){a=a.substr(a.indexOf(" ")+1).split(" ");return{type:a.shift(),parameter:a.join(" ")}};g.writeRtcpFb=function(a){var b="",c=a.payloadType;void 0!==a.preferredPayloadType&&(c=a.preferredPayloadType);a.rtcpFeedback&&a.rtcpFeedback.length&&a.rtcpFeedback.forEach(function(a){b+="a=rtcp-fb:"+c+" "+a.type+(a.parameter&&a.parameter.length?" "+a.parameter:"")+"\r\n"});return b};g.parseSsrcMedia=function(a){var b=a.indexOf(" "),c={ssrc:parseInt(a.substr(7,
b-7),10)},e=a.indexOf(":",b);-1<e?(c.attribute=a.substr(b+1,e-b-1),c.value=a.substr(e+1)):c.attribute=a.substr(b+1);return c};g.getMid=function(a){if(a=g.matchPrefix(a,"a=mid:")[0])return a.substr(6)};g.parseFingerprint=function(a){a=a.substr(14).split(" ");return{algorithm:a[0].toLowerCase(),value:a[1]}};g.getDtlsParameters=function(a,b){return{role:"auto",fingerprints:g.matchPrefix(a+b,"a=fingerprint:").map(g.parseFingerprint)}};g.writeDtlsParameters=function(a,b){var c="a=setup:"+b+"\r\n";a.fingerprints.forEach(function(a){c+=
"a=fingerprint:"+a.algorithm+" "+a.value+"\r\n"});return c};g.getIceParameters=function(a,b){a=g.splitLines(a);a=a.concat(g.splitLines(b));return{usernameFragment:a.filter(function(a){return 0===a.indexOf("a=ice-ufrag:")})[0].substr(12),password:a.filter(function(a){return 0===a.indexOf("a=ice-pwd:")})[0].substr(10)}};g.writeIceParameters=function(a){return"a=ice-ufrag:"+a.usernameFragment+"\r\na=ice-pwd:"+a.password+"\r\n"};g.parseRtpParameters=function(a){for(var b={codecs:[],headerExtensions:[],
fecMechanisms:[],rtcp:[]},c=g.splitLines(a)[0].split(" "),e=3;e<c.length;e++){var f=c[e],h=g.matchPrefix(a,"a=rtpmap:"+f+" ")[0];if(h){h=g.parseRtpMap(h);var m=g.matchPrefix(a,"a=fmtp:"+f+" ");h.parameters=m.length?g.parseFmtp(m[0]):{};h.rtcpFeedback=g.matchPrefix(a,"a=rtcp-fb:"+f+" ").map(g.parseRtcpFb);b.codecs.push(h);switch(h.name.toUpperCase()){case "RED":case "ULPFEC":b.fecMechanisms.push(h.name.toUpperCase())}}}g.matchPrefix(a,"a=extmap:").forEach(function(a){b.headerExtensions.push(g.parseExtmap(a))});
return b};g.writeRtpDescription=function(a,b){var c="";c+="m="+a+" ";c+=0<b.codecs.length?"9":"0";c+=" UDP/TLS/RTP/SAVPF ";c+=b.codecs.map(function(a){return void 0!==a.preferredPayloadType?a.preferredPayloadType:a.payloadType}).join(" ")+"\r\n";c+="c=IN IP4 0.0.0.0\r\n";c+="a=rtcp:9 IN IP4 0.0.0.0\r\n";b.codecs.forEach(function(a){c+=g.writeRtpMap(a);c+=g.writeFmtp(a);c+=g.writeRtcpFb(a)});var d=0;b.codecs.forEach(function(a){a.maxptime>d&&(d=a.maxptime)});0<d&&(c+="a=maxptime:"+d+"\r\n");c+="a=rtcp-mux\r\n";
b.headerExtensions.forEach(function(a){c+=g.writeExtmap(a)});return c};g.parseRtpEncodingParameters=function(a){var b=[],c=g.parseRtpParameters(a),e=-1!==c.fecMechanisms.indexOf("RED"),h=-1!==c.fecMechanisms.indexOf("ULPFEC"),p=g.matchPrefix(a,"a=ssrc:").map(function(a){return g.parseSsrcMedia(a)}).filter(function(a){return"cname"===a.attribute}),m=0<p.length&&p[0].ssrc,w;p=g.matchPrefix(a,"a=ssrc-group:FID").map(function(a){a=a.split(" ");a.shift();return a.map(function(a){return parseInt(a,10)})});
0<p.length&&1<p[0].length&&p[0][0]===m&&(w=p[0][1]);c.codecs.forEach(function(a){"RTX"===a.name.toUpperCase()&&a.parameters.apt&&(a={ssrc:m,codecPayloadType:parseInt(a.parameters.apt,10),rtx:{ssrc:w}},b.push(a),e&&(a=f.parse(f.stringify(a)),a.fec={ssrc:w,mechanism:h?"red+ulpfec":"red"},b.push(a)))});0===b.length&&m&&b.push({ssrc:m});var x=g.matchPrefix(a,"b=");x.length&&(x=0===x[0].indexOf("b=TIAS:")?parseInt(x[0].substr(7),10):0===x[0].indexOf("b=AS:")?950*parseInt(x[0].substr(5),10)-16E3:void 0,
b.forEach(function(a){a.maxBitrate=x}));return b};g.parseRtcpParameters=function(a){var b={},c=g.matchPrefix(a,"a=ssrc:").map(function(a){return g.parseSsrcMedia(a)}).filter(function(a){return"cname"===a.attribute})[0];c&&(b.cname=c.value,b.ssrc=c.ssrc);c=g.matchPrefix(a,"a=rtcp-rsize");b.reducedSize=0<c.length;b.compound=0===c.length;a=g.matchPrefix(a,"a=rtcp-mux");b.mux=0<a.length;return b};g.parseMsid=function(a){var b=g.matchPrefix(a,"a=msid:");if(1===b.length)return a=b[0].substr(7).split(" "),
{stream:a[0],track:a[1]};a=g.matchPrefix(a,"a=ssrc:").map(function(a){return g.parseSsrcMedia(a)}).filter(function(a){return"msid"===a.attribute});if(0<a.length)return a=a[0].value.split(" "),{stream:a[0],track:a[1]}};g.generateSessionId=function(){return Math.random().toString().substr(2,21)};g.writeSessionBoilerplate=function(a,b){b=void 0!==b?b:2;return"v=0\r\no=thisisadapterortc "+(a?a:g.generateSessionId())+" "+b+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"};g.writeMediaSection=function(a,b,c,e){b=
g.writeRtpDescription(a.kind,b);b+=g.writeIceParameters(a.iceGatherer.getLocalParameters());b+=g.writeDtlsParameters(a.dtlsTransport.getLocalParameters(),"offer"===c?"actpass":"active");b+="a=mid:"+a.mid+"\r\n";b=a.direction?b+("a="+a.direction+"\r\n"):a.rtpSender&&a.rtpReceiver?b+"a=sendrecv\r\n":a.rtpSender?b+"a=sendonly\r\n":a.rtpReceiver?b+"a=recvonly\r\n":b+"a=inactive\r\n";a.rtpSender&&(c="msid:"+e.id+" "+a.rtpSender.track.id+"\r\n",b=b+("a="+c)+("a=ssrc:"+a.sendEncodingParameters[0].ssrc+" "+
c),a.sendEncodingParameters[0].rtx&&(b+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" "+c,b+="a=ssrc-group:FID "+a.sendEncodingParameters[0].ssrc+" "+a.sendEncodingParameters[0].rtx.ssrc+"\r\n"));b+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" cname:"+g.localCName+"\r\n";a.rtpSender&&a.sendEncodingParameters[0].rtx&&(b+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" cname:"+g.localCName+"\r\n");return b};g.getDirection=function(a,b){a=g.splitLines(a);for(var c=0;c<a.length;c++)switch(a[c]){case "a=sendrecv":case "a=sendonly":case "a=recvonly":case "a=inactive":return a[c].substr(2)}return b?
g.getDirection(b):"sendrecv"};g.getKind=function(a){return g.splitLines(a)[0].split(" ")[0].substr(2)};g.isRejected=function(a){return"0"===a.split(" ",2)[1]};g.parseMLine=function(a){a=g.splitLines(a)[0].substr(2).split(" ");return{kind:a[0],port:parseInt(a[1],10),protocol:a[2],fmt:a.slice(3).join(" ")}};g.parseOLine=function(a){a=g.matchPrefix(a,"o=")[0].substr(2).split(" ");return{username:a[0],sessionId:a[1],sessionVersion:parseInt(a[2],10),netType:a[3],addressType:a[4],address:a[5]}};c$obj===
typeof h&&(h.exports=g)},{}],3:[function(b,f,h){h=c$und!==typeof l?l:c$und!==typeof self?self:c$und!==typeof window?window:{};b=b("./adapter_factory.js");f.exports=b({window:h.window})},{"./adapter_factory.js":4}],4:[function(b,f,h){var g=b("./utils");f.exports=function(a,d){a=a&&a.window;var c={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(e in d)hasOwnProperty.call(d,e)&&(c[e]=d[e]);d=g.log;var e=g.detectBrowser(a);var f=b("./chrome/chrome_shim")||null,h=b("./edge/edge_shim")||
null,m=b("./firefox/firefox_shim")||null,w=b("./safari/safari_shim")||null,x=b("./common_shim")||null,r={browserDetails:e,commonShim:x,extractVersion:g.extractVersion,disableLog:g.disableLog,disableWarnings:g.disableWarnings};switch(e.browser){case "chrome":if(!f||!f.shimPeerConnection||!c.shimChrome){d("Chrome shim is not included in this adapter release.");break}d("adapter.js shimming chrome.");r.browserShim=f;x.shimCreateObjectURL(a);f.shimGetUserMedia(a);f.shimMediaStream(a);f.shimSourceObject(a);
f.shimPeerConnection(a);f.shimOnTrack(a);f.shimAddTrackRemoveTrack(a);f.shimGetSendersWithDtmf(a);x.shimRTCIceCandidate(a);x.shimMaxMessageSize(a);x.shimSendThrowTypeError(a);break;case "firefox":if(!m||!m.shimPeerConnection||!c.shimFirefox){d("Firefox shim is not included in this adapter release.");break}d("adapter.js shimming firefox.");r.browserShim=m;x.shimCreateObjectURL(a);m.shimGetUserMedia(a);m.shimSourceObject(a);m.shimPeerConnection(a);m.shimOnTrack(a);m.shimRemoveStream(a);x.shimRTCIceCandidate(a);
x.shimMaxMessageSize(a);x.shimSendThrowTypeError(a);break;case "edge":if(!h||!h.shimPeerConnection||!c.shimEdge){d("MS edge shim is not included in this adapter release.");break}d("adapter.js shimming edge.");r.browserShim=h;x.shimCreateObjectURL(a);h.shimGetUserMedia(a);h.shimPeerConnection(a);h.shimReplaceTrack(a);x.shimMaxMessageSize(a);x.shimSendThrowTypeError(a);break;case "safari":if(!w||!c.shimSafari){d("Safari shim is not included in this adapter release.");break}d("adapter.js shimming safari.");
r.browserShim=w;x.shimCreateObjectURL(a);w.shimRTCIceServerUrls(a);w.shimCallbacksAPI(a);w.shimLocalStreamsAPI(a);w.shimRemoteStreamsAPI(a);w.shimTrackEventTransceiver(a);w.shimGetUserMedia(a);w.shimCreateOfferLegacy(a);x.shimRTCIceCandidate(a);x.shimMaxMessageSize(a);x.shimSendThrowTypeError(a);break;default:d("Unsupported browser!")}return r}},{"./chrome/chrome_shim":5,"./common_shim":7,"./edge/edge_shim":8,"./firefox/firefox_shim":10,"./safari/safari_shim":12,"./utils":13}],5:[function(b,h,l){var g=
b("../utils.js"),a=g.log;h.exports={shimGetUserMedia:b("./getusermedia"),shimMediaStream:function(a){a.MediaStream=a.MediaStream||a.webkitMediaStream},shimOnTrack:function(a){if(c$obj!==typeof a||!a.RTCPeerConnection||"ontrack"in a.RTCPeerConnection[c$pr])"RTCRtpTransceiver"in a||g.wrapPeerConnectionEvent(a,"track",function(a){a.transceiver||(a.transceiver={receiver:a.receiver});return a});else{Object.defineProperty(a.RTCPeerConnection[c$pr],"ontrack",{get:function(){return this._ontrack},
set:function(a){this._ontrack&&this.removeEventListener("track",this._ontrack);this.addEventListener("track",this._ontrack=a)}});var c=a.RTCPeerConnection[c$pr].setRemoteDescription;a.RTCPeerConnection[c$pr].setRemoteDescription=function(){var b=this;b._ontrackpoly||(b._ontrackpoly=function(c){c.stream.addEventListener("addtrack",function(d){var e=a.RTCPeerConnection[c$pr].getReceivers?b.getReceivers().find(function(a){return a.track&&a.track.id===d.track.id}):{track:d.track};var f=new Event("track");
f.track=d.track;f.receiver=e;f.transceiver={receiver:e};f.streams=[c.stream];b.dispatchEvent(f)});c.stream.getTracks().forEach(function(d){var e=a.RTCPeerConnection[c$pr].getReceivers?b.getReceivers().find(function(a){return a.track&&a.track.id===d.id}):{track:d};var f=new Event("track");f.track=d;f.receiver=e;f.transceiver={receiver:e};f.streams=[c.stream];b.dispatchEvent(f)})},b.addEventListener("addstream",b._ontrackpoly));return c.apply(b,arguments)}}},shimGetSendersWithDtmf:function(a){if(c$obj===
typeof a&&a.RTCPeerConnection&&!("getSenders"in a.RTCPeerConnection[c$pr])&&"createDTMFSender"in a.RTCPeerConnection[c$pr]){var c=function(a,c){return{track:c,get dtmf(){void 0===this._dtmf&&(this._dtmf="audio"===c.kind?a.createDTMFSender(c):null);return this._dtmf},_pc:a}};if(!a.RTCPeerConnection[c$pr].getSenders){a.RTCPeerConnection[c$pr].getSenders=function(){this._senders=this._senders||[];return this._senders.slice()};var b=a.RTCPeerConnection[c$pr].addTrack;a.RTCPeerConnection[c$pr].addTrack=
function(a,d){var e=b.apply(this,arguments);e||(e=c(this,a),this._senders.push(e));return e};var d=a.RTCPeerConnection[c$pr].removeTrack;a.RTCPeerConnection[c$pr].removeTrack=function(a){d.apply(this,arguments);var c=this._senders.indexOf(a);-1!==c&&this._senders.splice(c,1)}}var f=a.RTCPeerConnection[c$pr].addStream;a.RTCPeerConnection[c$pr].addStream=function(a){var b=this;b._senders=b._senders||[];f.apply(b,[a]);a.getTracks().forEach(function(a){b._senders.push(c(b,a))})};var g=
a.RTCPeerConnection[c$pr].removeStream;a.RTCPeerConnection[c$pr].removeStream=function(a){var c=this;c._senders=c._senders||[];g.apply(c,[a]);a.getTracks().forEach(function(a){var b=c._senders.find(function(c){return c.track===a});b&&c._senders.splice(c._senders.indexOf(b),1)})}}else if(c$obj===typeof a&&a.RTCPeerConnection&&"getSenders"in a.RTCPeerConnection[c$pr]&&"createDTMFSender"in a.RTCPeerConnection[c$pr]&&a.RTCRtpSender&&!("dtmf"in a.RTCRtpSender[c$pr])){var h=a.RTCPeerConnection[c$pr].getSenders;
a.RTCPeerConnection[c$pr].getSenders=function(){var a=this,c=h.apply(a,[]);c.forEach(function(c){c._pc=a});return c};Object.defineProperty(a.RTCRtpSender[c$pr],"dtmf",{get:function(){void 0===this._dtmf&&(this._dtmf="audio"===this.track.kind?this._pc.createDTMFSender(this.track):null);return this._dtmf}})}},shimSourceObject:function(a){var c=a&&a.URL;c$obj===typeof a&&(!a.HTMLMediaElement||"srcObject"in a.HTMLMediaElement[c$pr]||Object.defineProperty(a.HTMLMediaElement[c$pr],"srcObject",
{get:function(){return this._srcObject},set:function(a){var b=this;this._srcObject=a;this.src&&c.revokeObjectURL(this.src);a?(this.src=c.createObjectURL(a),a.addEventListener("addtrack",function(){b.src&&c.revokeObjectURL(b.src);b.src=c.createObjectURL(a)}),a.addEventListener("removetrack",function(){b.src&&c.revokeObjectURL(b.src);b.src=c.createObjectURL(a)})):this.src=""}}))},shimAddTrackRemoveTrackWithNative:function(a){a.RTCPeerConnection[c$pr].getLocalStreams=function(){var a=this;this._shimmedLocalStreams=
this._shimmedLocalStreams||{};return Object.keys(this._shimmedLocalStreams).map(function(c){return a._shimmedLocalStreams[c][0]})};var c=a.RTCPeerConnection[c$pr].addTrack;a.RTCPeerConnection[c$pr].addTrack=function(a,b){if(!b)return c.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var d=c.apply(this,arguments);this._shimmedLocalStreams[b.id]?-1===this._shimmedLocalStreams[b.id].indexOf(d)&&this._shimmedLocalStreams[b.id].push(d):this._shimmedLocalStreams[b.id]=
[b,d];return d};var b=a.RTCPeerConnection[c$pr].addStream;a.RTCPeerConnection[c$pr].addStream=function(a){var c=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{};a.getTracks().forEach(function(a){if(c.getSenders().find(function(c){return c.track===a}))throw new DOMException("Track already exists.","InvalidAccessError");});var d=c.getSenders();b.apply(this,arguments);var e=c.getSenders().filter(function(a){return-1===d.indexOf(a)});this._shimmedLocalStreams[a.id]=[a].concat(e)};
var d=a.RTCPeerConnection[c$pr].removeStream;a.RTCPeerConnection[c$pr].removeStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{};delete this._shimmedLocalStreams[a.id];return d.apply(this,arguments)};var f=a.RTCPeerConnection[c$pr].removeTrack;a.RTCPeerConnection[c$pr].removeTrack=function(a){var c=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{};a&&Object.keys(this._shimmedLocalStreams).forEach(function(b){var d=c._shimmedLocalStreams[b].indexOf(a);
-1!==d&&c._shimmedLocalStreams[b].splice(d,1);1===c._shimmedLocalStreams[b].length&&delete c._shimmedLocalStreams[b]});return f.apply(this,arguments)}},shimAddTrackRemoveTrack:function(a){function c(a,c){var b=c.sdp;Object.keys(a._reverseStreams||[]).forEach(function(c){c=a._reverseStreams[c];b=b.replace(new RegExp(a._streams[c.id].id,"g"),c.id)});return new RTCSessionDescription({type:c.type,sdp:b})}function b(a,c){var b=c.sdp;Object.keys(a._reverseStreams||[]).forEach(function(c){c=a._reverseStreams[c];
b=b.replace(new RegExp(c.id,"g"),a._streams[c.id].id)});return new RTCSessionDescription({type:c.type,sdp:b})}var d=g.detectBrowser(a);if(a.RTCPeerConnection[c$pr].addTrack&&65<=d.version)return this.shimAddTrackRemoveTrackWithNative(a);var f=a.RTCPeerConnection[c$pr].getLocalStreams;a.RTCPeerConnection[c$pr].getLocalStreams=function(){var a=this,c=f.apply(this);a._reverseStreams=a._reverseStreams||{};return c.map(function(c){return a._reverseStreams[c.id]})};var h=a.RTCPeerConnection[c$pr].addStream;
a.RTCPeerConnection[c$pr].addStream=function(c){var b=this;b._streams=b._streams||{};b._reverseStreams=b._reverseStreams||{};c.getTracks().forEach(function(a){if(b.getSenders().find(function(c){return c.track===a}))throw new DOMException("Track already exists.","InvalidAccessError");});if(!b._reverseStreams[c.id]){var d=new a.MediaStream(c.getTracks());b._streams[c.id]=d;b._reverseStreams[d.id]=c;c=d}h.apply(b,[c])};var l=a.RTCPeerConnection[c$pr].removeStream;a.RTCPeerConnection[c$pr].removeStream=
function(a){this._streams=this._streams||{};this._reverseStreams=this._reverseStreams||{};l.apply(this,[this._streams[a.id]||a]);delete this._reverseStreams[this._streams[a.id]?this._streams[a.id].id:a.id];delete this._streams[a.id]};a.RTCPeerConnection[c$pr].addTrack=function(c,b){var d=this;if("closed"===d.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var e=[].slice.call(arguments,1);if(1!==e.length||!e[0].getTracks().find(function(a){return a===
c}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(d.getSenders().find(function(a){return a.track===c}))throw new DOMException("Track already exists.","InvalidAccessError");d._streams=d._streams||{};d._reverseStreams=d._reverseStreams||{};(e=d._streams[b.id])?(e.addTrack(c),Promise.resolve().then(function(){d.dispatchEvent(new Event("negotiationneeded"))})):(e=new a.MediaStream([c]),d._streams[b.id]=
e,d._reverseStreams[e.id]=b,d.addStream(e));return d.getSenders().find(function(a){return a.track===c})};["createOffer","createAnswer"].forEach(function(b){var d=a.RTCPeerConnection[c$pr][b];a.RTCPeerConnection[c$pr][b]=function(){var a=this,b=arguments;return arguments.length&&c$fun===typeof arguments[0]?d.apply(a,[function(d){d=c(a,d);b[0].apply(null,[d])},function(a){b[1]&&b[1].apply(null,a)},arguments[2]]):d.apply(a,arguments).then(function(b){return c(a,b)})}});var x=a.RTCPeerConnection[c$pr].setLocalDescription;
a.RTCPeerConnection[c$pr].setLocalDescription=function(){if(!arguments.length||!arguments[0].type)return x.apply(this,arguments);arguments[0]=b(this,arguments[0]);return x.apply(this,arguments)};var r=Object.getOwnPropertyDescriptor(a.RTCPeerConnection[c$pr],"localDescription");Object.defineProperty(a.RTCPeerConnection[c$pr],"localDescription",{get:function(){var a=r.get.apply(this);return""===a.type?a:c(this,a)}});a.RTCPeerConnection[c$pr].removeTrack=function(a){var c=this;if("closed"===
c.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!a._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(a._pc!==c)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");c._streams=c._streams||{};var b;Object.keys(c._streams).forEach(function(d){c._streams[d].getTracks().find(function(c){return a.track===c})&&(b=c._streams[d])});
b&&(1===b.getTracks().length?c.removeStream(c._reverseStreams[b.id]):b.removeTrack(a.track),c.dispatchEvent(new Event("negotiationneeded")))}},shimPeerConnection:function(b){var c=g.detectBrowser(b);if(!b.RTCPeerConnection&&b.webkitRTCPeerConnection)b.RTCPeerConnection=function(c,d){a("PeerConnection");c&&c.iceTransportPolicy&&(c.iceTransports=c.iceTransportPolicy);return new b.webkitRTCPeerConnection(c,d)},b.RTCPeerConnection[c$pr]=b.webkitRTCPeerConnection[c$pr],b.webkitRTCPeerConnection.generateCertificate&&
Object.defineProperty(b.RTCPeerConnection,"generateCertificate",{get:function(){return b.webkitRTCPeerConnection.generateCertificate}});else{var d=b.RTCPeerConnection;b.RTCPeerConnection=function(a,c){if(a&&a.iceServers){for(var b=[],e=0;e<a.iceServers.length;e++){var h=a.iceServers[e];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(g.deprecated("RTCIceServer.url","RTCIceServer.urls"),h=f.parse(f.stringify(h)),h.urls=h.url,b.push(h)):b.push(a.iceServers[e])}a.iceServers=b}return new d(a,c)};b.RTCPeerConnection[c$pr]=
d[c$pr];Object.defineProperty(b.RTCPeerConnection,"generateCertificate",{get:function(){return d.generateCertificate}})}var h=b.RTCPeerConnection[c$pr].getStats;b.RTCPeerConnection[c$pr].getStats=function(a,c,b){var d=this,e=arguments;if(0<arguments.length&&c$fun===typeof a)return h.apply(this,arguments);if(0===h.length&&(0===arguments.length||c$fun!==typeof arguments[0]))return h.apply(this,[]);var f=function(a){var c={};a.result().forEach(function(a){var b={id:a.id,timestamp:a.timestamp,
type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[a.type]||a.type};a.names().forEach(function(c){b[c]=a.stat(c)});c[b.id]=b});return c},g=function(a){return new Map(Object.keys(a).map(function(c){return[c,a[c]]}))};return 2<=arguments.length?h.apply(this,[function(a){e[1](g(f(a)))},arguments[0]]):(new Promise(function(a,c){h.apply(d,[function(c){a(g(f(c)))},c])})).then(c,b)};51>c.version&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(a){var c=
b.RTCPeerConnection[c$pr][a];b.RTCPeerConnection[c$pr][a]=function(){var a=arguments,b=this,d=new Promise(function(d,e){c.apply(b,[a[0],d,e])});return 2>a.length?d:d.then(function(){a[1].apply(null,[])},function(c){3<=a.length&&a[2].apply(null,[c])})}});52>c.version&&["createOffer","createAnswer"].forEach(function(a){var c=b.RTCPeerConnection[c$pr][a];b.RTCPeerConnection[c$pr][a]=function(){var a=this;if(1>arguments.length||1===arguments.length&&c$obj===typeof arguments[0]){var b=
1===arguments.length?arguments[0]:void 0;return new Promise(function(d,e){c.apply(a,[d,e,b])})}return c.apply(this,arguments)}});["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(a){var c=b.RTCPeerConnection[c$pr][a];b.RTCPeerConnection[c$pr][a]=function(){arguments[0]=new ("addIceCandidate"===a?b.RTCIceCandidate:b.RTCSessionDescription)(arguments[0]);return c.apply(this,arguments)}});var p=b.RTCPeerConnection[c$pr].addIceCandidate;b.RTCPeerConnection[c$pr].addIceCandidate=
function(){return arguments[0]?p.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}}},{"../utils.js":13,"./getusermedia":6}],6:[function(b,h,l){var g=b("../utils.js"),a=g.log;h.exports=function(b){var c=g.detectBrowser(b),d=b&&b.navigator,h=function(a){if(c$obj!==typeof a||a.mandatory||a.optional)return a;var c={};Object.keys(a).forEach(function(b){if("require"!==b&&"advanced"!==b&&"mediaSource"!==b){var d=c$obj===typeof a[b]?a[b]:{ideal:a[b]};void 0!==d.exact&&
"number"===typeof d.exact&&(d.min=d.max=d.exact);var e=function(a,c){return a?a+c.charAt(0).toUpperCase()+c.slice(1):"deviceId"===c?"sourceId":c};if(void 0!==d.ideal){c.optional=c.optional||[];var f={};"number"===typeof d.ideal?(f[e("min",b)]=d.ideal,c.optional.push(f),f={},f[e("max",b)]=d.ideal):f[e("",b)]=d.ideal;c.optional.push(f)}void 0!==d.exact&&"number"!==typeof d.exact?(c.mandatory=c.mandatory||{},c.mandatory[e("",b)]=d.exact):["min","max"].forEach(function(a){void 0!==d[a]&&(c.mandatory=
c.mandatory||{},c.mandatory[e(a,b)]=d[a])})}});a.advanced&&(c.optional=(c.optional||[]).concat(a.advanced));return c},p=function(b,e){if(61<=c.version)return e(b);if((b=f.parse(f.stringify(b)))&&c$obj===typeof b.audio){var g=function(a,c,b){c in a&&!(b in a)&&(a[b]=a[c],delete a[c])};b=f.parse(f.stringify(b));g(b.audio,"autoGainControl","googAutoGainControl");g(b.audio,"noiseSuppression","googNoiseSuppression");b.audio=h(b.audio)}if(b&&c$obj===typeof b.video){var k=b.video.facingMode;k=k&&(c$obj===
typeof k?k:{ideal:k});g=66>c.version;if(!(!k||"user"!==k.exact&&"environment"!==k.exact&&"user"!==k.ideal&&"environment"!==k.ideal||d.mediaDevices.getSupportedConstraints&&d.mediaDevices.getSupportedConstraints().facingMode&&!g)){delete b.video.facingMode;if("environment"===k.exact||"environment"===k.ideal)var m=["back","rear"];else if("user"===k.exact||"user"===k.ideal)m=["front"];if(m)return d.mediaDevices.enumerateDevices().then(function(c){c=c.filter(function(a){return"videoinput"===a.kind});
var d=c.find(function(a){return m.some(function(c){return-1!==a.label.toLowerCase().indexOf(c)})});!d&&c.length&&-1!==m.indexOf("back")&&(d=c[c.length-1]);d&&(b.video.deviceId=k.exact?{exact:d.deviceId}:{ideal:d.deviceId});b.video=h(b.video);a("chrome: "+f.stringify(b));return e(b)})}b.video=h(b.video)}a("chrome: "+f.stringify(b));return e(b)},m=function(a){return{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",
ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};d.getUserMedia=function(a,c,b){p(a,function(a){d.webkitGetUserMedia(a,c,function(a){b&&b(m(a))})})};
var l=function(a){return new Promise(function(c,b){d.getUserMedia(a,c,b)})};d.mediaDevices||(d.mediaDevices={getUserMedia:l,enumerateDevices:function(){return new Promise(function(a){var c={audio:"audioinput",video:"videoinput"};return b.MediaStreamTrack.getSources(function(b){a(b.map(function(a){return{label:a.label,kind:c[a.kind],deviceId:a.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}});if(d.mediaDevices.getUserMedia){var n=
d.mediaDevices.getUserMedia.bind(d.mediaDevices);d.mediaDevices.getUserMedia=function(a){return p(a,function(a){return n(a).then(function(c){if(a.audio&&!c.getAudioTracks().length||a.video&&!c.getVideoTracks().length)throw c.getTracks().forEach(function(a){a.stop()}),new DOMException("","NotFoundError");return c},function(a){return Promise.reject(m(a))})})}}else d.mediaDevices.getUserMedia=function(a){return l(a)};c$und===typeof d.mediaDevices.addEventListener&&(d.mediaDevices.addEventListener=
function(){a("Dummy mediaDevices.addEventListener called.")});c$und===typeof d.mediaDevices.removeEventListener&&(d.mediaDevices.removeEventListener=function(){a("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":13}],7:[function(b,h,l){var g=b("sdp"),a=b("./utils");h.exports={shimRTCIceCandidate:function(b){if(b.RTCIceCandidate&&!(b.RTCIceCandidate&&"foundation"in b.RTCIceCandidate[c$pr])){var c=b.RTCIceCandidate;b.RTCIceCandidate=function(a){c$obj===typeof a&&a.candidate&&
0===a.candidate.indexOf("a=")&&(a=f.parse(f.stringify(a)),a.candidate=a.candidate.substr(2));if(a.candidate&&a.candidate.length){var b=new c(a);a=g.parseCandidate(a.candidate);var d=Object.assign(b,a);d.toJSON=function(){return{candidate:d.candidate,sdpMid:d.sdpMid,sdpMLineIndex:d.sdpMLineIndex,usernameFragment:d.usernameFragment}};return d}return new c(a)};b.RTCIceCandidate[c$pr]=c[c$pr];a.wrapPeerConnectionEvent(b,"icecandidate",function(a){a.candidate&&Object.defineProperty(a,"candidate",
{value:new b.RTCIceCandidate(a.candidate),writable:"false"});return a})}},shimCreateObjectURL:function(b){if(navigator&&!/iPhone|iPad|iPod/i.test(navigator.userAgent)&&-1==navigator.userAgent.toLowerCase().indexOf("chrome")&&11<=(-1!==navigator.userAgent.toLowerCase().indexOf("safari")&&parseFloat(navigator.userAgent.match(/version\/(\d+)/i)[1]))&&null===navigator.userAgent.match(/mobile\/(\d+)/i)||-1!==navigator.userAgent.toLowerCase().indexOf("firefox")){var c=b&&b.URL;if(c$obj===typeof b&&b.HTMLMediaElement&&
"srcObject"in b.HTMLMediaElement[c$pr]&&c.createObjectURL&&c.revokeObjectURL){var d=c.createObjectURL.bind(c),f=c.revokeObjectURL.bind(c),g=new Map,h=0;c.createObjectURL=function(c){if("getTracks"in c){var b="polyblob:"+ ++h;g.set(b,c);a.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream");return b}return d(c)};c.revokeObjectURL=function(a){f(a);g.delete(a)};var l=Object.getOwnPropertyDescriptor(b.HTMLMediaElement[c$pr],"src");Object.defineProperty(b.HTMLMediaElement[c$pr],
"src",{get:function(){return l.get.apply(this)},set:function(a){this.srcObject=g.get(a)||null;return l.set.apply(this,[a])}});var n=b.HTMLMediaElement[c$pr].setAttribute;b.HTMLMediaElement[c$pr].setAttribute=function(){2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=g.get(arguments[1])||null);return n.apply(this,arguments)}}}},shimMaxMessageSize:function(b){if(!b.RTCSctpTransport&&b.RTCPeerConnection){var c=a.detectBrowser(b);"sctp"in b.RTCPeerConnection[c$pr]||
Object.defineProperty(b.RTCPeerConnection[c$pr],"sctp",{get:function(){return c$und===typeof this._sctp?null:this._sctp}});var d=function(a){a=g.splitSections(a.sdp);a.shift();return a.some(function(a){return(a=g.parseMLine(a))&&"application"===a.kind&&-1!==a.protocol.indexOf("SCTP")})},f=function(a){a=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===a||2>a.length)return-1;a=parseInt(a[1],10);return a!==a?-1:a},h=function(a){var b=65536;"firefox"===c.browser&&(b=57>c.version?-1===
a?16384:2147483637:57===c.version?65535:65536);return b},m=function(a,b){var d=65536;"firefox"===c.browser&&57===c.version&&(d=65535);a=g.matchPrefix(a.sdp,"a=max-message-size:");0<a.length?d=parseInt(a[0].substr(19),10):"firefox"===c.browser&&-1!==b&&(d=2147483637);return d},l=b.RTCPeerConnection[c$pr].setRemoteDescription;b.RTCPeerConnection[c$pr].setRemoteDescription=function(){this._sctp=null;if(d(arguments[0])){var a=f(arguments[0]),c=h(a);a=m(arguments[0],a);var b=0===c&&0===a?Number.POSITIVE_INFINITY:
0===c||0===a?Math.max(c,a):Math.min(c,a);c={};Object.defineProperty(c,"maxMessageSize",{get:function(){return b}});this._sctp=c}return l.apply(this,arguments)}}},shimSendThrowTypeError:function(a){if(a.RTCPeerConnection&&"createDataChannel"in a.RTCPeerConnection[c$pr]){var c=a.RTCPeerConnection[c$pr].createDataChannel;a.RTCPeerConnection[c$pr].createDataChannel=function(){var a=this,b=c.apply(a,arguments),d=b.send;b.send=function(){var c=arguments[0];if((c.length||c.size||c.byteLength)>
a.sctp.maxMessageSize)throw new DOMException("Message too large (can send a maximum of "+a.sctp.maxMessageSize+" bytes)","TypeError");return d.apply(this,arguments)};return b}}}}},{"./utils":13,sdp:2}],8:[function(b,f,h){var g=b("../utils"),a=b("rtcpeerconnection-shim");f.exports={shimGetUserMedia:b("./getusermedia"),shimPeerConnection:function(b){var c=g.detectBrowser(b);if(b.RTCIceGatherer&&(b.RTCIceCandidate||(b.RTCIceCandidate=function(a){return a}),b.RTCSessionDescription||(b.RTCSessionDescription=
function(a){return a}),15025>c.version)){var d=Object.getOwnPropertyDescriptor(b.MediaStreamTrack[c$pr],"enabled");Object.defineProperty(b.MediaStreamTrack[c$pr],"enabled",{set:function(a){d.set.call(this,a);var c=new Event("enabled");c.enabled=a;this.dispatchEvent(c)}})}!b.RTCRtpSender||"dtmf"in b.RTCRtpSender[c$pr]||Object.defineProperty(b.RTCRtpSender[c$pr],"dtmf",{get:function(){void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new b.RTCDtmfSender(this):"video"===this.track.kind&&
(this._dtmf=null));return this._dtmf}});b.RTCDtmfSender&&!b.RTCDTMFSender&&(b.RTCDTMFSender=b.RTCDtmfSender);b.RTCPeerConnection=a(b,c.version)},shimReplaceTrack:function(a){!a.RTCRtpSender||"replaceTrack"in a.RTCRtpSender[c$pr]||(a.RTCRtpSender[c$pr].replaceTrack=a.RTCRtpSender[c$pr].setTrack)}}},{"../utils":13,"./getusermedia":9,"rtcpeerconnection-shim":1}],9:[function(b,f,h){f.exports=function(b){b=b&&b.navigator;var a=function(a){return{name:{PermissionDeniedError:"NotAllowedError"}[a.name]||
a.name,message:a.message,constraint:a.constraint,toString:function(){return this.name}}},d=b.mediaDevices.getUserMedia.bind(b.mediaDevices);b.mediaDevices.getUserMedia=function(c){return d(c).catch(function(c){return Promise.reject(a(c))})}}},{}],10:[function(b,f,h){var g=b("../utils");f.exports={shimGetUserMedia:b("./getusermedia"),shimOnTrack:function(a){c$obj!==typeof a||!a.RTCPeerConnection||"ontrack"in a.RTCPeerConnection[c$pr]||Object.defineProperty(a.RTCPeerConnection[c$pr],"ontrack",
{get:function(){return this._ontrack},set:function(a){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly));this.addEventListener("track",this._ontrack=a);this.addEventListener("addstream",this._ontrackpoly=function(a){a.stream.getTracks().forEach(function(c){var b=new Event("track");b.track=c;b.receiver={track:c};b.transceiver={receiver:b.receiver};b.streams=[a.stream];this.dispatchEvent(b)}.bind(this))}.bind(this))}});c$obj===
typeof a&&a.RTCTrackEvent&&"receiver"in a.RTCTrackEvent[c$pr]&&!("transceiver"in a.RTCTrackEvent[c$pr])&&Object.defineProperty(a.RTCTrackEvent[c$pr],"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(a){c$obj===typeof a&&(!a.HTMLMediaElement||"srcObject"in a.HTMLMediaElement[c$pr]||Object.defineProperty(a.HTMLMediaElement[c$pr],"srcObject",{get:function(){return this.mozSrcObject},set:function(a){this.mozSrcObject=a}}))},shimPeerConnection:function(a){var b=
g.detectBrowser(a);if(c$obj===typeof a&&(a.RTCPeerConnection||a.mozRTCPeerConnection)){a.RTCPeerConnection||(a.RTCPeerConnection=function(c,d){if(38>b.version&&c&&c.iceServers){for(var e=[],f=0;f<c.iceServers.length;f++){var g=c.iceServers[f];if(g.hasOwnProperty("urls"))for(var h=0;h<g.urls.length;h++){var k={url:g.urls[h]};0===g.urls[h].indexOf("turn")&&(k.username=g.username,k.credential=g.credential);e.push(k)}else e.push(c.iceServers[f])}c.iceServers=e}return new a.mozRTCPeerConnection(c,d)},
a.RTCPeerConnection[c$pr]=a.mozRTCPeerConnection[c$pr],a.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get:function(){return a.mozRTCPeerConnection.generateCertificate}}),a.RTCSessionDescription=a.mozRTCSessionDescription,a.RTCIceCandidate=a.mozRTCIceCandidate);["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){var b=a.RTCPeerConnection[c$pr][c];a.RTCPeerConnection[c$pr][c]=function(){arguments[0]=
new ("addIceCandidate"===c?a.RTCIceCandidate:a.RTCSessionDescription)(arguments[0]);return b.apply(this,arguments)}});var c=a.RTCPeerConnection[c$pr].addIceCandidate;a.RTCPeerConnection[c$pr].addIceCandidate=function(){return arguments[0]?c.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var e=function(a){var c=new Map;Object.keys(a).forEach(function(b){c.set(b,a[b]);c[b]=a[b]});return c},f={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",
localcandidate:"local-candidate",remotecandidate:"remote-candidate"},h=a.RTCPeerConnection[c$pr].getStats;a.RTCPeerConnection[c$pr].getStats=function(a,c,d){return h.apply(this,[a||null]).then(function(a){48>b.version&&(a=e(a));if(53>b.version&&!c)try{a.forEach(function(a){a.type=f[a.type]||a.type})}catch(B){if("TypeError"!==B.name)throw B;a.forEach(function(c,b){a.set(b,Object.assign({},c,{type:f[c.type]||c.type}))})}return a}).then(c,d)}}},shimRemoveStream:function(a){!a.RTCPeerConnection||
"removeStream"in a.RTCPeerConnection[c$pr]||(a.RTCPeerConnection[c$pr].removeStream=function(a){var c=this;g.deprecated("removeStream","removeTrack");this.getSenders().forEach(function(b){b.track&&-1!==a.getTracks().indexOf(b.track)&&c.removeTrack(b)})})}}},{"../utils":13,"./getusermedia":11}],11:[function(b,h,l){var g=b("../utils"),a=g.log;h.exports=function(b){var c=g.detectBrowser(b),d=b&&b.navigator;b=b&&b.MediaStreamTrack;var h=function(a){return{name:{InternalError:"NotReadableError",
NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[a.name]||a.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[a.message]||a.message,constraint:a.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},l=function(b,e,g){var k=function(a){if(c$obj!==typeof a||a.require)return a;var b=[];Object.keys(a).forEach(function(c){if("require"!==
c&&"advanced"!==c&&"mediaSource"!==c){var d=a[c]=c$obj===typeof a[c]?a[c]:{ideal:a[c]};void 0===d.min&&void 0===d.max&&void 0===d.exact||b.push(c);void 0!==d.exact&&("number"===typeof d.exact?d.min=d.max=d.exact:a[c]=d.exact,delete d.exact);if(void 0!==d.ideal){a.advanced=a.advanced||[];var e={};e[c]="number"===typeof d.ideal?{min:d.ideal,max:d.ideal}:d.ideal;a.advanced.push(e);delete d.ideal;Object.keys(d).length||delete a[c]}}});b.length&&(a.require=b);return a};b=f.parse(f.stringify(b));38>
c.version&&(a("spec: "+f.stringify(b)),b.audio&&(b.audio=k(b.audio)),b.video&&(b.video=k(b.video)),a("ff37: "+f.stringify(b)));return d.mozGetUserMedia(b,e,function(a){g(h(a))})},m=function(a){return new Promise(function(b,c){l(a,b,c)})};d.mediaDevices||(d.mediaDevices={getUserMedia:m,addEventListener:function(){},removeEventListener:function(){}});d.mediaDevices.enumerateDevices=d.mediaDevices.enumerateDevices||function(){return new Promise(function(a){a([{kind:"audioinput",deviceId:"default",label:"",
groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})};if(41>c.version){var n=d.mediaDevices.enumerateDevices.bind(d.mediaDevices);d.mediaDevices.enumerateDevices=function(){return n().then(void 0,function(a){if("NotFoundError"===a.name)return[];throw a;})}}if(49>c.version){var x=d.mediaDevices.getUserMedia.bind(d.mediaDevices);d.mediaDevices.getUserMedia=function(a){return x(a).then(function(b){if(a.audio&&!b.getAudioTracks().length||a.video&&!b.getVideoTracks().length)throw b.getTracks().forEach(function(a){a.stop()}),
new DOMException("The object can not be found here.","NotFoundError");return b},function(a){return Promise.reject(h(a))})}}if(!(55<c.version&&"autoGainControl"in d.mediaDevices.getSupportedConstraints())){var r=function(a,b,c){b in a&&!(c in a)&&(a[c]=a[b],delete a[b])},v=d.mediaDevices.getUserMedia.bind(d.mediaDevices);d.mediaDevices.getUserMedia=function(a){c$obj===typeof a&&c$obj===typeof a.audio&&(a=f.parse(f.stringify(a)),r(a.audio,"autoGainControl","mozAutoGainControl"),r(a.audio,"noiseSuppression",
"mozNoiseSuppression"));return v(a)};if(b&&b[c$pr].getSettings){var u=b[c$pr].getSettings;b[c$pr].getSettings=function(){var a=u.apply(this,arguments);r(a,"mozAutoGainControl","autoGainControl");r(a,"mozNoiseSuppression","noiseSuppression");return a}}if(b&&b[c$pr].applyConstraints){var z=b[c$pr].applyConstraints;b[c$pr].applyConstraints=function(a){"audio"===this.kind&&c$obj===typeof a&&(a=f.parse(f.stringify(a)),r(a,"autoGainControl","mozAutoGainControl"),r(a,"noiseSuppression",
"mozNoiseSuppression"));return z.apply(this,[a])}}}d.getUserMedia=function(a,b,e){if(44>c.version)return l(a,b,e);g.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia");d.mediaDevices.getUserMedia(a).then(b,e)}}},{"../utils":13}],12:[function(b,h,l){var g=b("../utils");h.exports={shimLocalStreamsAPI:function(a){if(c$obj===typeof a&&a.RTCPeerConnection){"getLocalStreams"in a.RTCPeerConnection[c$pr]||(a.RTCPeerConnection[c$pr].getLocalStreams=function(){this._localStreams||
(this._localStreams=[]);return this._localStreams});"getStreamById"in a.RTCPeerConnection[c$pr]||(a.RTCPeerConnection[c$pr].getStreamById=function(a){var b=null;this._localStreams&&this._localStreams.forEach(function(c){c.id===a&&(b=c)});this._remoteStreams&&this._remoteStreams.forEach(function(c){c.id===a&&(b=c)});return b});if(!("addStream"in a.RTCPeerConnection[c$pr])){var b=a.RTCPeerConnection[c$pr].addTrack;a.RTCPeerConnection[c$pr].addStream=function(a){this._localStreams||
(this._localStreams=[]);-1===this._localStreams.indexOf(a)&&this._localStreams.push(a);var c=this;a.getTracks().forEach(function(d){b.call(c,d,a)})};a.RTCPeerConnection[c$pr].addTrack=function(a,d){d&&(this._localStreams?-1===this._localStreams.indexOf(d)&&this._localStreams.push(d):this._localStreams=[d]);return b.call(this,a,d)}}"removeStream"in a.RTCPeerConnection[c$pr]||(a.RTCPeerConnection[c$pr].removeStream=function(a){this._localStreams||(this._localStreams=[]);var b=this._localStreams.indexOf(a);
if(-1!==b){this._localStreams.splice(b,1);var c=this,d=a.getTracks();this.getSenders().forEach(function(a){-1!==d.indexOf(a.track)&&c.removeTrack(a)})}})}},shimRemoteStreamsAPI:function(a){c$obj===typeof a&&a.RTCPeerConnection&&("getRemoteStreams"in a.RTCPeerConnection[c$pr]||(a.RTCPeerConnection[c$pr].getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),"onaddstream"in a.RTCPeerConnection[c$pr]||Object.defineProperty(a.RTCPeerConnection[c$pr],"onaddstream",
{get:function(){return this._onaddstream},set:function(a){var b=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly));this.addEventListener("addstream",this._onaddstream=a);this.addEventListener("track",this._onaddstreampoly=function(a){a.streams.forEach(function(a){b._remoteStreams||(b._remoteStreams=[]);if(!(0<=b._remoteStreams.indexOf(a))){b._remoteStreams.push(a);var c=new Event("addstream");c.stream=a;b.dispatchEvent(c)}})})}}))},
shimCallbacksAPI:function(a){if(c$obj===typeof a&&a.RTCPeerConnection){a=a.RTCPeerConnection[c$pr];var b=a.createOffer,c=a.createAnswer,e=a.setLocalDescription,f=a.setRemoteDescription,g=a.addIceCandidate;a.createOffer=function(a,c){var d=b.apply(this,[2<=arguments.length?arguments[2]:arguments[0]]);if(!c)return d;d.then(a,c);return Promise.resolve()};a.createAnswer=function(a,b){var d=c.apply(this,[2<=arguments.length?arguments[2]:arguments[0]]);if(!b)return d;d.then(a,b);return Promise.resolve()};
var h=function(a,b,c){a=e.apply(this,[a]);if(!c)return a;a.then(b,c);return Promise.resolve()};a.setLocalDescription=h;h=function(a,b,c){a=f.apply(this,[a]);if(!c)return a;a.then(b,c);return Promise.resolve()};a.setRemoteDescription=h;h=function(a,b,c){a=g.apply(this,[a]);if(!c)return a;a.then(b,c);return Promise.resolve()};a.addIceCandidate=h}},shimGetUserMedia:function(a){var b=a&&a.navigator;b.getUserMedia||(b.webkitGetUserMedia?b.getUserMedia=b.webkitGetUserMedia.bind(b):b.mediaDevices&&b.mediaDevices.getUserMedia&&
(b.getUserMedia=function(a,d,f){b.mediaDevices.getUserMedia(a).then(d,f)}.bind(b)))},shimRTCIceServerUrls:function(a){var b=a.RTCPeerConnection;a.RTCPeerConnection=function(a,d){if(a&&a.iceServers){for(var c=[],e=0;e<a.iceServers.length;e++){var h=a.iceServers[e];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(g.deprecated("RTCIceServer.url","RTCIceServer.urls"),h=f.parse(f.stringify(h)),h.urls=h.url,delete h.url,c.push(h)):c.push(a.iceServers[e])}a.iceServers=c}return new b(a,d)};a.RTCPeerConnection[c$pr]=
b[c$pr];"generateCertificate"in a.RTCPeerConnection&&Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get:function(){return b.generateCertificate}})},shimTrackEventTransceiver:function(a){c$obj===typeof a&&a.RTCPeerConnection&&"receiver"in a.RTCTrackEvent[c$pr]&&!a.RTCTransceiver&&Object.defineProperty(a.RTCTrackEvent[c$pr],"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(a){var b=a.RTCPeerConnection[c$pr].createOffer;
a.RTCPeerConnection[c$pr].createOffer=function(a){if(a){c$und!==typeof a.offerToReceiveAudio&&(a.offerToReceiveAudio=!!a.offerToReceiveAudio);var c=this.getTransceivers().find(function(a){return a.sender.track&&"audio"===a.sender.track.kind});!1===a.offerToReceiveAudio&&c?"sendrecv"===c.direction?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":"recvonly"===c.direction&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):!0!==a.offerToReceiveAudio||c||this.addTransceiver("audio");
c$und!==typeof a.offerToReceiveAudio&&(a.offerToReceiveVideo=!!a.offerToReceiveVideo);c=this.getTransceivers().find(function(a){return a.sender.track&&"video"===a.sender.track.kind});!1===a.offerToReceiveVideo&&c?"sendrecv"===c.direction?c.setDirection("sendonly"):"recvonly"===c.direction&&c.setDirection("inactive"):!0!==a.offerToReceiveVideo||c||this.addTransceiver("video")}return b.apply(this,arguments)}}}},{"../utils":13}],13:[function(b,f,h){function g(a,b,d){return(a=a.match(b))&&a.length>=
d&&parseInt(a[d],10)}var a=!0,d=!0;f.exports={extractVersion:g,wrapPeerConnectionEvent:function(a,b,d){if(a.RTCPeerConnection){a=a.RTCPeerConnection[c$pr];var c=a.addEventListener;a.addEventListener=function(a,e){if(a!==b)return c.apply(this,arguments);var f=function(a){e(d(a))};this._eventMap=this._eventMap||{};this._eventMap[e]=f;return c.apply(this,[a,f])};var e=a.removeEventListener;a.removeEventListener=function(a,c){if(a!==b||!this._eventMap||!this._eventMap[c])return e.apply(this,arguments);
var d=this._eventMap[c];delete this._eventMap[c];return e.apply(this,[a,d])};Object.defineProperty(a,"on"+b,{get:function(){return this["_on"+b]},set:function(a){this["_on"+b]&&(this.removeEventListener(b,this["_on"+b]),delete this["_on"+b]);a&&this.addEventListener(b,this["_on"+b]=a)}})}},disableLog:function(b){return"boolean"!==typeof b?Error("Argument type: "+typeof b+". Please use a boolean."):(a=b)?"adapter.js logging disabled":"adapter.js logging enabled"},disableWarnings:function(a){if("boolean"!==
typeof a)return Error("Argument type: "+typeof a+". Please use a boolean.");d=!a;return"adapter.js deprecation warnings "+(a?"disabled":"enabled")},log:function(){c$obj!==typeof window||a||c$und!==typeof console&&c$fun===typeof console.log&&console.log.apply(console,arguments)},deprecated:function(a,b){d&&console.warn(a+" is deprecated, please use "+b+" instead.")},detectBrowser:function(a){var b=a&&a.navigator,c={browser:null,version:null};if(c$und===typeof a||!a.navigator)return c.browser=
"Not a browser.",c;b.mozGetUserMedia?(c.browser="firefox",c.version=g(b.userAgent,/Firefox\/(\d+)\./,1)):b.webkitGetUserMedia?(c.browser="chrome",c.version=g(b.userAgent,/Chrom(e|ium)\/(\d+)\./,2)):b.mediaDevices&&b.userAgent.match(/Edge\/(\d+).(\d+)$/)?(c.browser="edge",c.version=g(b.userAgent,/Edge\/(\d+).(\d+)$/,2)):a.RTCPeerConnection&&b.userAgent.match(/AppleWebKit\/(\d+)\./)?(c.browser="safari",c.version=g(b.userAgent,/AppleWebKit\/(\d+)\./,1)):c.browser="Not a supported browser.";return c}}},
{}]},{},[3])(3)}()}).call(n,h(54))},53:function(b,n,h){n.__esModule=!0;b=h(1);h(22);h(31);h(178);h(21);h(321);h(89);b.event.special.destroyed={remove:function(b){b.handler&&b.handler()}};n.default=b}});
}())
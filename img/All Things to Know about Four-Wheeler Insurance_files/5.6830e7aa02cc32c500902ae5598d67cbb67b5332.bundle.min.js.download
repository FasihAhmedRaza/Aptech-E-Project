/** Tagove! **/!function(){var t="prototype",e="undefined",s=s||{};s.scope={},s.arrayIteratorImpl=function(t){var e=0;return function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}},s.arrayIterator=function(t){return{next:s.arrayIteratorImpl(t)}},s.m=function(t){var n=e!=typeof Symbol&&Symbol.iterator&&t[Symbol.iterator];return n?n.call(t):s.arrayIterator(t)},$tgwbpk([5],{329:function(n,o,i){o.__esModule=!0;var r=i(6),u=i(90),c=i(11),a=i(434),h=i(10);(n=function(t,e,s){c.default.create(this),this.connector=null,this.details=s,this.path="/signaling/a-"+t,this.socket=null,this.event_map=[],this.app=e,this.users={},this.ready=!1,this._users={},this._links={},this._rooms={}})[t].updateDetails=function(t){this.details=t},n[t].getUserId=function(t){for(var e in this._users)if(this._users[e]==t)return e;return"string"==typeof t&&0<=t.indexOf("@")?(t=t.split("@"),this._users[t[0]]=parseInt(t[1]),t[0]):null},n[t].user=function(t,n,o,i,r){var u=this;if(o=void 0===o?a.default:o,e==typeof this.users[t.id]&&(this.users[t.id]={}),(e==typeof this.users[t.id][n]||e==typeof this.users[t.id][n].id)&&((o=new o(n,t,i,r)).on("dispose",function(){delete u.users[t.id][n]},this),i=this.users[t.id][n],this.users[t.id][n]=o,i))for(i=s.m(i),r=i.next();!r.done;r=i.next())(r=r.value)(o);return this.users[t.id][n]},n[t].start=function(){var t=this;this.connector||(this.connector=new u.default("p2p",this.app,r.default.signaling_server,this.path,!0),this.connector.on("connect",function(e){t.socket=t.connector.server,e="1"==(e=t.app.account().settings.video_recording)||"on"==e;var s=t.app.account().settings.cobrowse_record_session;s="1"==s||"on"==s,t.socket.on("session_conflict",function(){console.log("[p2p] session_conflict"),t.connector.suspend()});var n=h.default.trackTimeEvent("p2p","register");t.socket.emit("register",t.details.id,t.details.key,{recording:e,cobrowse_recording:s,account:t.app.account().uid},function(e,s,o){n(),e||(t._users[t.details.id]=parseInt(s),t.event_map=o,t.ready=!0,t.trigger("ready"))})}),this.connector.on("disconnect",function(e){t.trigger("disconnect"),t.ready=!1;for(var s in t.users)for(var n in t.users[s])t.users[s]&&t.users[s][n].trigger("leave");t._users={},t._links={},t._rooms={}}))},n[t].quit=function(t,s){null!=this.socket&&(e!==typeof this._rooms[t]&&null!=this._rooms[t]&&this.socket.off(this._rooms[t]),delete this._rooms[t],this.socket&&this.socket.emit("quit",t))},n[t].join=function(t,s){var n=this;if(e!==typeof this._rooms[t])return console.error("[p2p] room already joined.");this._rooms[t]=null;var o=h.default.trackTimeEvent("p2p","join-"+t);this.socket.emit("join",t,!1,!0,function(i){o(),n._rooms[t]=parseInt(i);var r=function(s,o,r){for(var u=[],c=2;c<arguments.length;++c)u[c-2]=arguments[c];if(o="string"==typeof o?o:n.event_map[o],"string"!=typeof s&&"number"!=typeof s&&(console.error("invalid uid recevied from server room:"+t+" rid:"+i+" uid:"+s+" type:"+o),console.error(s),console.error(o),console.error(u)),c=n.getUserId(s),u.unshift(o),null!==c){e==typeof n.users[t]&&(n.users[t]={}),n.users[t][c]=n.users[t][c]?n.users[t][c]:[];var a=n.users[t][c];a&&e!==typeof a.id?(a.trigger.apply(a,u),a.onMsg.apply(a,u)):(a.push(function(t){t.trigger.apply(t,u),t.onMsg.apply(t,u)}),n.users[t][c]=a)}else console.error("[p2p] user sending message even we've not joined him..")};n.socket.on(i,r),n.on("disconnect",function(){n.socket.off(i,r)}),s&&s.on&&s.on("dispose",function(){n.socket&&n.socket.off(i)},n),n.socket.emit("join-success",!1,i)})},n[t].onDispose=function(){this.users={},this.connector&&this.connector.suspend()},n[t].onDestroy=function(){for(var t in this)this[t]=null},n[t].whenReady=function(t){this.ready?t():this.once("ready",t)},n[t].broadcast=function(t,s,n){var o=this;this.whenReady(function(){e!==typeof o._rooms[t]&&(s=0<=o.event_map.indexOf(s)?o.event_map.indexOf(s):s,n.unshift(s),n.unshift(0-o._rooms[t]),o.socket.emit.apply(o.socket,n))})},n[t].msg=function(t,e,s){null!==this.event_map&&(e=0<=this.event_map.indexOf(e)?this.event_map.indexOf(e):e,s.unshift(e),s.unshift(t),this.socket.emit.apply(this.socket,s))},n[t].trackEvent=function(t,e,s){this.socket.emit("event",t,e,s)},o.default=n},434:function(e,s,n){s.__esModule=!0;var o=n(10),i=n(11),r=n(9);(e=function(t,e){var s=this;i.default.create(this),this.id=t,this.module=e,this._state=null,this.self=e.channel.details.id==t;var n=o.default.trackTimeEvent("p2p","peer-join");this.on("join",function(t,e){n(),s._state=t}),this.on("leave",function(){s._state=null}),this.module.channel.on("disconnect",function(){s._state=null})})[t].onDestroy=function(){for(var t in this)r.default.disposeKoItem(this[t]),delete this[t]},e[t].onMsg=function(t,e){},e[t].msg=function(t,e){for(var s=[],n=1;n<arguments.length;++n)s[n-1]=arguments[n];var o=this;this.self?(s.unshift(t),this.trigger.apply(this,s),this.onMsg.apply(this,s)):this.module&&this.module.chat&&(this.module.start(),this._state?this.module.channel.msg(this._state,t,s):this.once("join",function(e,n){o.module.channel.msg(e,t,s)}))},s.default=e}})}();